<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>GyattChores</title>
    <link rel="icon" type="image/svg+xml" href="gyattchores-logo-transparent.svg">
    <link rel="apple-touch-icon" href="gyattchores-logo-transparent.svg">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Google+Sans+Display:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        html {
            overflow-x: hidden;
            width: 100%;
            max-width: 100%;
        }
        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
            font-family: 'Google Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            position: relative;
        }
        #root {
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
        }
        input, textarea, button {
            font-family: 'Google Sans', sans-serif;
        }
        
        /* Apple-like Subtle Shadows */
        .elevation-1 {
            box-shadow: 0 1px 3px 0 rgba(0,0,0,.08), 0 1px 2px 0 rgba(0,0,0,.06);
        }
        .elevation-2 {
            box-shadow: 0 2px 8px 0 rgba(0,0,0,.1), 0 1px 4px 0 rgba(0,0,0,.08);
        }
        .elevation-3 {
            box-shadow: 0 4px 16px 0 rgba(0,0,0,.12), 0 2px 6px 0 rgba(0,0,0,.1);
        }
        
        /* Material Design Ripple Effect */
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        .ripple {
            position: relative;
            overflow: hidden;
        }
        
        .ripple:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .ripple:active:before {
            width: 300px;
            height: 300px;
            transition: 0s;
        }
        
        /* Smooth transitions */
        * {
            transition: background-color 0.2s cubic-bezier(0.4, 0.0, 0.2, 1),
                        color 0.2s cubic-bezier(0.4, 0.0, 0.2, 1),
                        box-shadow 0.2s cubic-bezier(0.4, 0.0, 0.2, 1);
        }
        
        .dashboard-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            padding: 0 12px;
            width: 100%;
        }

        .dashboard-grid > div {
            flex: 1 1 300px;
            min-width: 0;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                flex-direction: column;
                gap: 8px;
                padding: 0 8px;
            }

            /* Reorder for mobile: Available Chores first, Players second, Pending third */
            .dashboard-grid > div:nth-child(1) { order: 2; }
            .dashboard-grid > div:nth-child(2) { order: 1; }
            .dashboard-grid > div:nth-child(3) { order: 3; }
        }
        
        .text-wrap {
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }
        
        /* Floating Action Button */
        .fab {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            border: none;
            transition: all 0.2s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        .fab:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px 0 rgba(0,0,0,.15);
        }

        .fab:active {
            transform: scale(0.95);
        }

        /* Apple-style Card */
        .material-card {
            border-radius: 16px;
            transition: all 0.2s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        .material-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px 0 rgba(0,0,0,.12), 0 2px 6px 0 rgba(0,0,0,.1);
        }
        
        /* Chip Style */
        .chip {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8125rem;
            font-weight: 500;
        }

        /* Input Apple Style */
        .material-input {
            width: 100%;
            padding: 12px 16px;
            border-radius: 10px;
            border: 1px solid;
            font-size: 1rem;
            outline: none;
            transition: all 0.2s cubic-bezier(0.25, 0.1, 0.25, 1);
            box-sizing: border-box;
        }

        .material-input:focus {
            border-width: 2px;
            padding: 11px 15px;
        }

        /* Fix for date inputs on iOS */
        input[type="date"] {
            display: block;
            width: 100% !important;
            max-width: 100% !important;
            min-width: 0 !important;
            overflow: hidden;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            flex-shrink: 0;
            margin-left: auto;
        }

        input[type="date"]::-webkit-datetime-edit {
            flex-grow: 1;
            overflow: hidden;
        }

        /* Button Apple Style */
        .material-button {
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            font-size: 0.9375rem;
            font-weight: 500;
            letter-spacing: -0.01em;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.25, 0.1, 0.25, 1);
            box-sizing: border-box;
        }

        .material-button:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px 0 rgba(0,0,0,.15);
        }

        .material-button:active {
            transform: scale(0.98);
        }
        
        /* Smooth scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0,0,0,0.3);
        }

        /* Achievement notification animation */
        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive Design for Mobile Devices */

        /* Small Phones (iPhone SE, iPhone 12 mini, etc.) */
        @media (max-width: 430px) {
            body {
                font-size: 14px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 12px;
                padding: 0 12px;
            }

            .material-card {
                padding: 16px !important;
                margin-bottom: 8px !important;
            }

            /* Header adjustments */
            .fab {
                width: 44px;
                height: 44px;
                font-size: 16px;
            }

            /* Reduce massive tablet-sized fonts for phones */
            h1 {
                font-size: 1.25rem !important;
            }

            /* Player cards - scale down from tablet size */
            div[style*="fontSize: '1.75rem'"] {
                font-size: 1rem !important;
            }

            div[style*="fontSize: '3.5rem'"] {
                font-size: 2rem !important;
            }

            /* Chore items - scale down */
            div[style*="fontSize: '1.375rem'"] {
                font-size: 0.875rem !important;
            }

            div[style*="fontSize: '2.25rem'"] {
                font-size: 1.25rem !important;
            }

            /* Buttons - make more reasonable size */
            .material-button {
                padding: 10px 16px !important;
                font-size: 0.875rem !important;
            }

            button[style*="fontSize: '1.125rem'"] {
                font-size: 0.875rem !important;
                padding: 10px 14px !important;
            }

            /* Chips and badges */
            .chip {
                font-size: 0.7rem !important;
                padding: 3px 8px !important;
            }

            /* Touch targets should still be big enough */
            button {
                min-height: 44px;
                box-sizing: border-box;
            }

            /* Ensure all buttons respect width constraints */
            .material-button,
            button {
                max-width: 100%;
            }

            /* Player name truncation on mobile */
            div[style*="fontSize: '1.75rem'"] {
                overflow: hidden !important;
                text-overflow: ellipsis !important;
                white-space: nowrap !important;
            }

            /* Ensure all text content respects container width */
            .material-card > * {
                max-width: 100%;
                overflow-wrap: break-word;
            }

            /* Chore card adjustments for mobile */
            div[style*="padding: '20px'"] {
                padding: 14px !important;
            }

            /* Ensure chore name displays properly */
            div[style*="fontSize: '1.125rem'"] {
                font-size: 0.9375rem !important;
            }
        }

        /* Standard Phones (iPhone 15 Pro, iPhone 16, etc.) */
        @media (min-width: 431px) and (max-width: 768px) {
            body {
                font-size: 15px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 16px;
                padding: 0 16px;
            }

            .material-card {
                padding: 20px !important;
                margin-bottom: 10px !important;
            }

            .fab {
                width: 44px;
                height: 44px;
                font-size: 18px;
            }

            /* Scale down tablet fonts for phone */
            h1 {
                font-size: 1.5rem !important;
            }

            /* Player names */
            div[style*="fontSize: '1.75rem'"] {
                font-size: 1.125rem !important;
            }

            /* Player avatars */
            div[style*="fontSize: '3.5rem'"] {
                font-size: 2.5rem !important;
            }

            /* Chore names */
            div[style*="fontSize: '1.375rem'"] {
                font-size: 1rem !important;
            }

            /* Chore icons */
            div[style*="fontSize: '2.25rem'"] {
                font-size: 1.5rem !important;
            }

            /* Buttons */
            .material-button {
                padding: 12px 18px !important;
                font-size: 1rem !important;
            }

            button[style*="fontSize: '1.125rem'"] {
                font-size: 1rem !important;
                padding: 12px 16px !important;
            }

            .chip {
                font-size: 0.75rem !important;
            }

            button {
                min-height: 44px;
                box-sizing: border-box;
            }

            /* Ensure all buttons respect width constraints */
            .material-button,
            button {
                max-width: 100%;
            }

            /* Text truncation for longer content */
            div[style*="fontSize: '1.75rem'"],
            div[style*="fontSize: '1.375rem'"] {
                overflow: hidden !important;
                text-overflow: ellipsis !important;
                white-space: nowrap !important;
            }
        }

        /* iPads in Portrait (iPad 5th gen, iPad Air, etc.) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
                gap: 18px;
                padding: 0 18px;
            }

            .material-card {
                padding: 24px !important;
            }

            .fab {
                width: 46px;
                height: 46px;
            }

            /* Slightly reduce tablet fonts for iPad */
            h1 {
                font-size: 1.75rem !important;
            }

            div[style*="fontSize: '1.75rem'"] {
                font-size: 1.5rem !important;
            }

            div[style*="fontSize: '3.5rem'"] {
                font-size: 3rem !important;
            }

            div[style*="fontSize: '1.375rem'"] {
                font-size: 1.25rem !important;
            }

            div[style*="fontSize: '2.25rem'"] {
                font-size: 2rem !important;
            }

            button[style*="fontSize: '1.125rem'"] {
                font-size: 1.0625rem !important;
            }
        }

        /* Wall-mounted tablets and desktop (1024px+) - Keep current large sizes */
        @media (min-width: 1025px) {
            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
                gap: 20px;
                padding: 0 20px;
                width: 100%;
            }

            /* Current large sizes are perfect for wall-mounted displays */
        }

        /* Landscape phone adjustments */
        @media (max-height: 500px) and (orientation: landscape) {
            .material-card {
                padding: 12px !important;
                margin-bottom: 8px !important;
            }

            h1 {
                font-size: 1.125rem !important;
            }

            .fab {
                width: 44px;
                height: 44px;
                font-size: 14px;
            }

            button {
                min-height: 44px;
            }
        }

        /* Safe area padding for modern iPhones (notch/Dynamic Island) */
        @supports (padding: max(0px)) {
            body {
                padding-left: env(safe-area-inset-left);
                padding-right: env(safe-area-inset-right);
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }

        /* Ensure all containers respect viewport width */
        .dashboard-grid,
        .material-card,
        div[style*="width"],
        div[style*="maxWidth"] {
            max-width: 100% !important;
        }

        /* Keyboard focus indicators for accessibility */
        button:focus-visible,
        a:focus-visible,
        input:focus-visible,
        select:focus-visible {
            outline: 3px solid #1a73e8;
            outline-offset: 2px;
            border-radius: 4px;
        }

        /* Reduce motion for users who prefer it */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Improve input font size on mobile to prevent zoom */
        @media (max-width: 768px) {
            input, textarea, select {
                font-size: 16px !important;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Initialize Supabase
        const supabase = window.supabase.createClient(
            'https://ukshxdoqgwoxobjdclpx.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVrc2h4ZG9xZ3dveG9iamRjbHB4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3MjI2NDEsImV4cCI6MjA4MDI5ODY0MX0.UGNrsfG6goEA0PPWG4x7gxBueA7D5Oe9uWI-iCXIar0'
        );

        const LOGIN_PASSWORD = "0413";
        const APPROVAL_CODE = "1214";

        // Daily motivational quotes from kid-friendly characters
        const MOTIVATIONAL_QUOTES = [
            { quote: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
            { quote: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
            { quote: "Do or do not. There is no try.", author: "Yoda" },
            { quote: "It always seems impossible until it's done.", author: "Nelson Mandela" },
            { quote: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
            { quote: "You're braver than you believe, stronger than you seem, and smarter than you think.", author: "Christopher Robin" },
            { quote: "All our dreams can come true, if we have the courage to pursue them.", author: "Walt Disney" },
            { quote: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
            { quote: "Why do we fall? So we can learn to pick ourselves back up.", author: "Batman" },
            { quote: "With great power comes great responsibility.", author: "Spider-Man" },
            { quote: "Even miracles take a little time.", author: "Fairy Godmother" },
            { quote: "The flower that blooms in adversity is the most rare and beautiful of all.", author: "The Emperor (Mulan)" },
            { quote: "Just keep swimming!", author: "Dory" },
            { quote: "Adventure is out there!", author: "Ellie (Up)" },
            { quote: "To infinity and beyond!", author: "Buzz Lightyear" },
            { quote: "Ohana means family, and family means nobody gets left behind.", author: "Stitch" },
            { quote: "The past can hurt, but you can either run from it or learn from it.", author: "Rafiki" },
            { quote: "No matter how your heart is grieving, if you keep on believing, the dream that you wish will come true.", author: "Cinderella" },
            { quote: "Sometimes the right path is not the easiest one.", author: "Grandmother Willow" },
            { quote: "It's kind of fun to do the impossible.", author: "Walt Disney" },
            { quote: "A person's a person, no matter how small.", author: "Dr. Seuss" },
            { quote: "Don't cry because it's over, smile because it happened.", author: "Dr. Seuss" },
            { quote: "Today you are You, that is truer than true. There is no one alive who is Youer than You.", author: "Dr. Seuss" },
            { quote: "You have brains in your head. You have feet in your shoes. You can steer yourself any direction you choose.", author: "Dr. Seuss" },
            { quote: "The more that you read, the more things you will know. The more that you learn, the more places you'll go.", author: "Dr. Seuss" },
            { quote: "Nothing is impossible. The word itself says 'I'm possible!'", author: "Audrey Hepburn" },
            { quote: "A champion is someone who gets up when they can't.", author: "Jack Dempsey" },
            { quote: "Winning isn't everything, but wanting to win is.", author: "Vince Lombardi" },
            { quote: "The only limit to our realization of tomorrow will be our doubts of today.", author: "Franklin D. Roosevelt" },
            { quote: "Don't let what you cannot do interfere with what you can do.", author: "John Wooden" }
        ];

        // Get daily quote (same quote for everyone on the same day)
        const getDailyQuote = () => {
            const now = new Date();
            const start = new Date(now.getFullYear(), 0, 1);
            const dayOfYear = Math.max(0, Math.floor((now - start) / (1000 * 60 * 60 * 24)));
            const safeIndex = Math.floor(Math.abs(dayOfYear) % MOTIVATIONAL_QUOTES.length);
            return MOTIVATIONAL_QUOTES[safeIndex] || MOTIVATIONAL_QUOTES[0];
        };

        const getLastFridayOfMonth = () => {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            const lastDay = new Date(year, month + 1, 0);
            
            while (lastDay.getDay() !== 5) {
                lastDay.setDate(lastDay.getDate() - 1);
            }
            
            return lastDay.toLocaleDateString('en-US', { 
                month: 'long', 
                day: 'numeric',
                year: 'numeric'
            });
        };

        function FamilyChores() {
            // Auto-detect dark mode based on time of day (6 AM - 6 PM = light, else dark)
            const getInitialDarkMode = () => {
                const hour = new Date().getHours();
                return hour < 6 || hour >= 18;
            };

            const [isLoggedIn, setIsLoggedIn] = useState(() => {
                return localStorage.getItem('gyatt_session') === 'active';
            });
            const [darkMode, setDarkMode] = useState(getInitialDarkMode);
            const [loading, setLoading] = useState(true);
            const [players, setPlayers] = useState([]);
            const [chores, setChores] = useState([]);
            const [pendingChores, setPendingChores] = useState([]);
            const [allCompletions, setAllCompletions] = useState([]);
            const [availableTasks, setAvailableTasks] = useState([]);

            const [newTaskName, setNewTaskName] = useState('');
            const [newTaskPoints, setNewTaskPoints] = useState('');
            const [newTaskDueDate, setNewTaskDueDate] = useState('');
            const [approvalCode, setApprovalCode] = useState('');
            const [showApproval, setShowApproval] = useState(null);

            // GOAT System states
            const [weeklyGoats, setWeeklyGoats] = useState([]);
            const [lastWeekGoat, setLastWeekGoat] = useState(null);

            // Weekly Reset states
            const [currentWeekStart, setCurrentWeekStart] = useState(null);
            const [needsWeeklyReset, setNeedsWeeklyReset] = useState(false);

            // Profile page states
            const [showProfile, setShowProfile] = useState(false);
            const [selectedPlayer, setSelectedPlayer] = useState(null);
            const [playerHistory, setPlayerHistory] = useState([]);

            // Monthly view states
            const [showMonthlyView, setShowMonthlyView] = useState(false);
            const [monthlyChores, setMonthlyChores] = useState([]);

            // Admin menu states
            const [showAdminMenu, setShowAdminMenu] = useState(false);
            const [editingChore, setEditingChore] = useState(null);
            const [errorLogs, setErrorLogs] = useState([]);
            const [errorStats, setErrorStats] = useState([]);

            // Bonus system states
            const [playerBonuses, setPlayerBonuses] = useState({});

            // Weather states
            const [weather, setWeather] = useState(null);
            const [weatherLoading, setWeatherLoading] = useState(true);

            // Achievement system states
            const [achievements, setAchievements] = useState([]);
            const [playerAchievements, setPlayerAchievements] = useState({});
            const [playerStats, setPlayerStats] = useState({});
            const [newAchievements, setNewAchievements] = useState([]);

            // Chore description states
            const [expandedChoreId, setExpandedChoreId] = useState(null);

            // Pull to refresh states
            const [isPulling, setIsPulling] = useState(false);
            const [pullDistance, setPullDistance] = useState(0);
            const [refreshing, setRefreshing] = useState(false);

            // Login states
            const [loginPassword, setLoginPassword] = useState('');
            const [loginError, setLoginError] = useState('');

            // Login handler
            const handleLogin = async (e) => {
                e.preventDefault();
                if (loginPassword === LOGIN_PASSWORD) {
                    try {
                        localStorage.setItem('gyatt_session', 'active');
                    } catch (e) {
                        if (e.name === 'QuotaExceededError') {
                            console.warn('localStorage quota exceeded, clearing old data');
                            localStorage.clear();
                            localStorage.setItem('gyatt_session', 'active');
                        }
                    }
                    setIsLoggedIn(true);
                    setLoginError('');
                } else {
                    setLoginError('Invalid password');
                    setLoginPassword('');
                    haptic('error');
                    // Log failed login attempt
                    await logError('login_failed', 'Incorrect password entered', loginPassword);
                }
            };

            // Logout handler
            const handleLogout = () => {
                localStorage.removeItem('gyatt_session');
                setIsLoggedIn(false);
            };

            // Haptic feedback utility
            const haptic = (type = 'light') => {
                if (!navigator.vibrate) return;

                const patterns = {
                    light: 10,
                    medium: 20,
                    heavy: 30,
                    success: [10, 50, 10],
                    error: [30, 100, 30],
                    click: 5
                };

                navigator.vibrate(patterns[type] || 10);
            };

            // Pull to refresh handler
            const handleRefresh = async () => {
                setRefreshing(true);
                haptic('medium');

                try {
                    await loadData();
                    await loadAllCompletions();
                    haptic('success');
                } catch (error) {
                    console.error('Refresh error:', error);
                    haptic('error');
                }

                setTimeout(() => {
                    setRefreshing(false);
                    setPullDistance(0);
                }, 500);
            };

            // Pull to refresh touch handlers
            useEffect(() => {
                let startY = 0;
                let scrollTop = 0;

                const handleTouchStart = (e) => {
                    scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                    startY = e.touches[0].pageY;
                };

                const handleTouchMove = (e) => {
                    if (scrollTop > 5) return; // Only work when at top

                    const currentY = e.touches[0].pageY;
                    const distance = currentY - startY;

                    if (distance > 0 && distance < 150) {
                        setIsPulling(true);
                        setPullDistance(distance);
                        if (distance > 10) {
                            haptic('light');
                        }
                    }
                };

                const handleTouchEnd = () => {
                    if (pullDistance > 80) {
                        handleRefresh();
                    } else {
                        setPullDistance(0);
                    }
                    setIsPulling(false);
                };

                document.addEventListener('touchstart', handleTouchStart);
                document.addEventListener('touchmove', handleTouchMove);
                document.addEventListener('touchend', handleTouchEnd);

                return () => {
                    document.removeEventListener('touchstart', handleTouchStart);
                    document.removeEventListener('touchmove', handleTouchMove);
                    document.removeEventListener('touchend', handleTouchEnd);
                };
            }, [pullDistance]);

            // Session timeout - auto logout after 30 minutes of inactivity
            useEffect(() => {
                if (!isLoggedIn) return;

                const sessionTimeout = 30 * 60 * 1000; // 30 minutes
                const timer = setTimeout(() => {
                    handleLogout();
                    haptic('medium');
                    alert('â±ï¸ Session expired due to inactivity. Please log in again.');
                }, sessionTimeout);

                return () => clearTimeout(timer);
            }, [isLoggedIn]);

            // Load data from Supabase
            useEffect(() => {
                const checkAndReset = async () => {
                    await loadData();

                    // If reset is needed, trigger it automatically
                    if (needsWeeklyReset) {
                        await performWeeklyReset();
                    }
                };

                checkAndReset();
            }, []);

            // Auto-refresh for wall-mounted display - refresh every 15 minutes
            useEffect(() => {
                const interval = setInterval(() => {
                    console.log('Auto-refreshing data for wall display...');
                    loadData();
                }, 900000); // 15 minutes

                return () => clearInterval(interval);
            }, []);

            const loadData = async () => {
                try {
                    setLoading(true);

                    // Check current week and if reset is needed
                    const monday = new Date();
                    const dayOfWeek = monday.getDay();
                    const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
                    monday.setDate(monday.getDate() + daysToMonday);
                    monday.setHours(0, 0, 0, 0);
                    const weekStartDate = monday.toISOString().split('T')[0];

                    // Check if we've already reset this week
                    const { data: resetData } = await supabase
                        .from('weekly_resets')
                        .select('*')
                        .eq('week_start_date', weekStartDate)
                        .single();

                    // If no reset record for this week exists, we need to reset
                    if (!resetData) {
                        setNeedsWeeklyReset(true);
                        setCurrentWeekStart(weekStartDate);
                    }

                    // Load players
                    const { data: playersData, error: playersError } = await supabase
                        .from('players')
                        .select('*')
                        .order('name');

                    if (playersError) throw playersError;

                    // Load chores
                    const { data: choresData, error: choresError } = await supabase
                        .from('chores')
                        .select('*')
                        .eq('is_active', true)
                        .order('name');

                    if (choresError) throw choresError;

                    // Load pending chore completions
                    const { data: pendingData, error: pendingError } = await supabase
                        .from('chore_completions')
                        .select(`
                            *,
                            players(name),
                            chores(name, icon)
                        `)
                        .eq('status', 'pending')
                        .order('completed_at', { ascending: false });

                    if (pendingError) throw pendingError;

                    // Load all APPROVED completions from past 7 days for cooldown checking
                    const sevenDaysAgo = new Date();
                    sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
                    const { data: allCompletionsData } = await supabase
                        .from('chore_completions')
                        .select('chore_id, completed_at')
                        .eq('status', 'approved')
                        .gte('completed_at', sevenDaysAgo.toISOString())
                        .order('completed_at', { ascending: false });

                    // Get weekly totals for each player
                    const playersWithStats = await Promise.all(playersData.map(async (player) => {
                        const { count } = await supabase
                            .from('chore_completions')
                            .select('*', { count: 'exact', head: true })
                            .eq('player_id', player.id)
                            .eq('status', 'approved');

                        // Get current week's points
                        const monday = new Date();
                        const dayOfWeek = monday.getDay();
                        const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
                        monday.setDate(monday.getDate() + daysToMonday);
                        monday.setHours(0, 0, 0, 0);
                        const weekStartDate = monday.toISOString().split('T')[0];

                        const { data: weeklyData } = await supabase
                            .from('chore_completions')
                            .select('value_awarded')
                            .eq('player_id', player.id)
                            .eq('status', 'approved')
                            .gte('completed_date', weekStartDate);

                        const chorePoints = weeklyData?.reduce((sum, c) => sum + c.value_awarded, 0) || 0;

                        // Get current week's bonuses
                        const { data: bonusData } = await supabase
                            .from('bonuses')
                            .select('bonus_amount')
                            .eq('player_id', player.id)
                            .eq('week_start_date', weekStartDate);

                        const bonusPoints = bonusData?.reduce((sum, b) => sum + b.bonus_amount, 0) || 0;

                        return {
                            id: player.id,
                            name: player.name,
                            avatar: player.avatar_url,
                            points: chorePoints + bonusPoints,
                            completedChores: count || 0,
                            best_week_total: player.best_week_total
                        };
                    }));

                    // Format chores
                    const formattedChores = choresData.map(chore => ({
                        id: chore.id,
                        name: chore.name,
                        points: chore.base_value,
                        icon: chore.icon,
                        max_per_day: chore.max_per_day,
                        description: chore.description,
                        cooldown_hours: chore.cooldown_hours || 24
                    }));

                    // Format pending chores
                    const formattedPending = pendingData.map(completion => ({
                        id: completion.id,
                        playerId: completion.player_id,
                        choreId: completion.chore_id,
                        choreName: completion.chores?.name || 'Unknown Chore',
                        points: completion.value_awarded,
                        icon: completion.chores?.icon || 'â“',
                        status: 'pending',
                        timestamp: new Date(completion.completed_at)
                    }));

                    setPlayers(playersWithStats);
                    setChores(formattedChores);
                    setPendingChores(formattedPending);
                    setAllCompletions(allCompletionsData || []);

                    // Get current week's GOAT(s)
                    const { data: goatData } = await supabase
                        .rpc('get_weekly_goat');

                    setWeeklyGoats(goatData || []);

                    // Load achievements data
                    const { data: achievementsData } = await supabase
                        .from('achievements')
                        .select('*')
                        .order('requirement_value', { ascending: true });

                    const { data: playerAchievementsData } = await supabase
                        .from('player_achievements')
                        .select('*');

                    const { data: playerStatsData } = await supabase
                        .from('player_stats')
                        .select('*');

                    setAchievements(achievementsData || []);

                    // Group player achievements by player_id
                    const achievementsByPlayer = {};
                    (playerAchievementsData || []).forEach(pa => {
                        if (!achievementsByPlayer[pa.player_id]) {
                            achievementsByPlayer[pa.player_id] = [];
                        }
                        achievementsByPlayer[pa.player_id].push(pa);
                    });
                    setPlayerAchievements(achievementsByPlayer);

                    // Group player stats by player_id
                    const statsByPlayer = {};
                    (playerStatsData || []).forEach(ps => {
                        statsByPlayer[ps.player_id] = ps;
                    });
                    setPlayerStats(statsByPlayer);

                    // Get last week's GOAT for display
                    const lastMonday = new Date(monday);
                    lastMonday.setDate(lastMonday.getDate() - 7);

                    const { data: prevWeekData } = await supabase
                        .rpc('get_weekly_totals', {
                            week_start: lastMonday.toISOString().split('T')[0]
                        });

                    if (prevWeekData && prevWeekData.length > 0) {
                        const maxTotal = Math.max(...prevWeekData.map(p => p.weekly_total));
                        const lastWeekWinners = prevWeekData.filter(p => p.weekly_total === maxTotal && maxTotal > 0);
                        setLastWeekGoat(lastWeekWinners.length > 0 ? lastWeekWinners : null);
                    }

                } catch (error) {
                    console.error('Error loading data:', error);
                    haptic('error');
                    alert(`Error loading data: ${error.message || 'Unknown error'}`);
                } finally {
                    setLoading(false);
                }
            };

            // Call bonus checker after loading data
            useEffect(() => {
                if (!loading && players.length > 0) {
                    checkAndAwardBonuses();
                }
            }, [players, loading]);

            // Fetch weather on mount
            useEffect(() => {
                fetchWeather();
            }, []);

            // Material Design with Brand Colors
            const darkTheme = {
                bg: '#0D121A',
                surface: '#1F1F1F',
                surfaceVariant: '#363845',
                text: '#E8EAED',
                textSecondary: '#9AA0A6',
                primary: '#47B2C4',
                primaryVariant: '#3498B0',
                secondary: '#F23861',
                secondaryVariant: '#D91F4A',
                tertiary: '#B59ED9',
                error: '#F28B82',
                success: '#81C995',
                cardBg: '#1E1E1E',
                cardText: '#E8EAED',
                onPrimary: '#000000',
                outline: '#5F6368',
                accent: '#120ACC'
            };

            const lightTheme = {
                bg: '#F6F0E0',
                surface: '#FFFFFF',
                surfaceVariant: '#F6F0E0',
                text: '#1B1714',
                textSecondary: '#5F6368',
                primary: '#D0A500',
                primaryVariant: '#B89300',
                secondary: '#F85D00',
                secondaryVariant: '#E04F00',
                tertiary: '#EB701E',
                error: '#B3261E',
                success: '#0F9D58',
                cardBg: '#FFFFFF',
                cardText: '#1B1714',
                onPrimary: '#FFFFFF',
                outline: '#79747E',
                accent: '#EB701E'
            };

            // Memoize theme to prevent unnecessary re-renders
            const theme = React.useMemo(() =>
                darkMode ? darkTheme : lightTheme,
                [darkMode]
            );

            // Helper function to check if player is GOAT
            const isGoat = (playerId) => {
                return weeklyGoats.some(goat => goat.player_id === playerId);
            };

            // Check and award bonuses
            const checkAndAwardBonuses = async () => {
                try {
                    const monday = new Date();
                    const dayOfWeek = monday.getDay();
                    const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
                    monday.setDate(monday.getDate() + daysToMonday);
                    monday.setHours(0, 0, 0, 0);
                    const weekStartDate = monday.toISOString().split('T')[0];

                    // Get last week's GOAT total
                    const lastMonday = new Date(monday);
                    lastMonday.setDate(lastMonday.getDate() - 7);

                    const { data: lastWeekTotals } = await supabase
                        .rpc('get_weekly_totals', {
                            week_start: lastMonday.toISOString().split('T')[0]
                        });

                    const lastWeekGoatTotal = lastWeekTotals && lastWeekTotals.length > 0
                        ? Math.max(...lastWeekTotals.map(p => p.weekly_total))
                        : 0;

                    // Check bonuses for each player
                    for (const player of players) {
                        // Check Beat Last Week's GOAT bonus (ðŸ”¥)
                        if (lastWeekGoatTotal > 0 && player.points > lastWeekGoatTotal) {
                            // Check if bonus already awarded this week
                            const { data: existing } = await supabase
                                .from('bonuses')
                                .select('*')
                                .eq('player_id', player.id)
                                .eq('week_start_date', weekStartDate)
                                .eq('bonus_type', 'beat_goat')
                                .single();

                            if (!existing) {
                                const bonusAmount = 500; // 500 point bonus
                                await supabase
                                    .from('bonuses')
                                    .insert([{
                                        player_id: player.id,
                                        week_start_date: weekStartDate,
                                        bonus_type: 'beat_goat',
                                        bonus_amount: bonusAmount
                                    }]);
                                console.log(`ðŸ”¥ Beat GOAT bonus awarded to ${player.name}!`);
                            }
                        }

                        // Check Beat Personal Best bonus (ðŸš€)
                        if (player.best_week_total > 0 && player.points > player.best_week_total) {
                            // Check if bonus already awarded this week
                            const { data: existing } = await supabase
                                .from('bonuses')
                                .select('*')
                                .eq('player_id', player.id)
                                .eq('week_start_date', weekStartDate)
                                .eq('bonus_type', 'beat_personal_best')
                                .single();

                            if (!existing) {
                                const bonusAmount = 750; // 750 point bonus
                                await supabase
                                    .from('bonuses')
                                    .insert([{
                                        player_id: player.id,
                                        week_start_date: weekStartDate,
                                        bonus_type: 'beat_personal_best',
                                        bonus_amount: bonusAmount
                                    }]);

                                // Update personal best
                                await supabase
                                    .from('players')
                                    .update({ best_week_total: player.points })
                                    .eq('id', player.id);

                                console.log(`ðŸš€ Personal Best bonus awarded to ${player.name}!`);
                            }
                        }
                    }

                    // Load current week's bonuses for display
                    const { data: bonuses } = await supabase
                        .from('bonuses')
                        .select('*')
                        .eq('week_start_date', weekStartDate);

                    const bonusMap = {};
                    bonuses?.forEach(bonus => {
                        if (!bonusMap[bonus.player_id]) {
                            bonusMap[bonus.player_id] = [];
                        }
                        bonusMap[bonus.player_id].push(bonus);
                    });
                    setPlayerBonuses(bonusMap);

                } catch (error) {
                    console.error('Error checking bonuses:', error);
                }
            };

            // Check and award achievements
            const checkAndAwardAchievements = async (playerId) => {
                try {
                    // Get current player stats
                    const { data: stats } = await supabase
                        .from('player_stats')
                        .select('*')
                        .eq('player_id', playerId)
                        .single();

                    if (!stats) return;

                    // Get player's current achievements
                    const { data: earnedAchievements } = await supabase
                        .from('player_achievements')
                        .select('achievement_id')
                        .eq('player_id', playerId);

                    const earnedIds = new Set(earnedAchievements?.map(a => a.achievement_id) || []);

                    // Check each achievement
                    const newlyEarned = [];
                    for (const achievement of achievements) {
                        // Skip if already earned
                        if (earnedIds.has(achievement.id)) continue;

                        let earned = false;

                        switch (achievement.requirement_type) {
                            case 'total_chores':
                                earned = stats.total_chores_completed >= achievement.requirement_value;
                                break;
                            case 'total_points':
                                earned = stats.total_points_earned >= achievement.requirement_value;
                                break;
                            case 'goat_wins':
                                earned = stats.goat_wins >= achievement.requirement_value;
                                break;
                            case 'streak_days':
                                earned = stats.current_streak >= achievement.requirement_value ||
                                         stats.longest_streak >= achievement.requirement_value;
                                break;
                            case 'special':
                                if (achievement.name === 'Early Bird') {
                                    earned = stats.early_bird_count >= achievement.requirement_value;
                                } else if (achievement.name === 'Night Owl') {
                                    earned = stats.night_owl_count >= achievement.requirement_value;
                                } else if (achievement.name === 'Overachiever') {
                                    earned = stats.personal_best_beats >= achievement.requirement_value;
                                }
                                break;
                        }

                        if (earned) {
                            // Award the achievement
                            await supabase
                                .from('player_achievements')
                                .insert([{
                                    player_id: playerId,
                                    achievement_id: achievement.id
                                }]);

                            newlyEarned.push(achievement);
                        }
                    }

                    // Show notifications for newly earned achievements
                    if (newlyEarned.length > 0) {
                        setNewAchievements(prev => [...prev, ...newlyEarned.map(a => ({
                            ...a,
                            playerId
                        }))]);

                        // Auto-dismiss after 5 seconds
                        setTimeout(() => {
                            setNewAchievements(prev => prev.filter(na =>
                                !newlyEarned.some(ne => ne.id === na.id && na.playerId === playerId)
                            ));
                        }, 5000);

                        // Reload data to show new achievements
                        await loadData();
                    }
                } catch (error) {
                    console.error('Error checking achievements:', error);
                }
            };

            // Update player stats when chore is completed
            const updatePlayerStats = async (playerId, choreCompletedAt, pointsAwarded) => {
                try {
                    const { data: stats } = await supabase
                        .from('player_stats')
                        .select('*')
                        .eq('player_id', playerId)
                        .single();

                    const completedDate = new Date(choreCompletedAt).toISOString().split('T')[0];
                    const completedHour = new Date(choreCompletedAt).getHours();
                    const today = new Date().toISOString().split('T')[0];

                    // Calculate streak
                    let newStreak = 1;
                    if (stats.last_activity_date) {
                        const lastDate = new Date(stats.last_activity_date);
                        const currentDate = new Date(completedDate);
                        const daysDiff = Math.floor((currentDate - lastDate) / (1000 * 60 * 60 * 24));

                        if (daysDiff === 1) {
                            // Consecutive day
                            newStreak = (stats.current_streak || 0) + 1;
                        } else if (daysDiff === 0) {
                            // Same day
                            newStreak = stats.current_streak || 1;
                        }
                        // If daysDiff > 1, streak breaks, reset to 1
                    }

                    // Update stats
                    await supabase
                        .from('player_stats')
                        .update({
                            total_chores_completed: (stats.total_chores_completed || 0) + 1,
                            total_points_earned: (stats.total_points_earned || 0) + pointsAwarded,
                            current_streak: newStreak,
                            longest_streak: Math.max(stats.longest_streak || 0, newStreak),
                            last_activity_date: completedDate,
                            early_bird_count: completedHour < 12 ? (stats.early_bird_count || 0) + 1 : stats.early_bird_count,
                            night_owl_count: completedHour >= 18 ? (stats.night_owl_count || 0) + 1 : stats.night_owl_count,
                            updated_at: new Date().toISOString()
                        })
                        .eq('player_id', playerId);

                    // Check for Speed Demon achievement (5 chores in one day)
                    const { data: todayCompletions } = await supabase
                        .from('chore_completions')
                        .select('id')
                        .eq('player_id', playerId)
                        .eq('completed_date', today)
                        .eq('status', 'approved');

                    if (todayCompletions && todayCompletions.length >= 5) {
                        // Mark Speed Demon progress
                        await checkAndAwardAchievements(playerId);
                    }

                    // Check for achievements
                    await checkAndAwardAchievements(playerId);
                } catch (error) {
                    console.error('Error updating player stats:', error);
                }
            };

            // Fetch weather for Brighton, CO
            const fetchWeather = async () => {
                try {
                    // Check cache (localStorage with 30-min expiry)
                    const cached = localStorage.getItem('weather_cache');
                    if (cached) {
                        const { data, timestamp } = JSON.parse(cached);
                        const age = Date.now() - timestamp;
                        if (age < 30 * 60 * 1000) { // 30 minutes
                            setWeather(data);
                            setWeatherLoading(false);
                            return;
                        }
                    }

                    // Brighton, CO location
                    const location = 'Brighton,Colorado';

                    // Using free wttr.in API (no key required)
                    const url = `https://wttr.in/${location}?format=j1`;

                    // Add timeout to prevent hanging
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout

                    try {
                        const response = await fetch(url, { signal: controller.signal });
                        clearTimeout(timeoutId);
                        const data = await response.json();

                    // Validate weather data structure
                    if (!data.current_condition || !data.current_condition[0]) {
                        throw new Error('Invalid weather data structure');
                    }

                    const currentCondition = data.current_condition[0];

                    if (!currentCondition.weatherDesc || !currentCondition.weatherDesc[0]) {
                        throw new Error('Invalid weather description data');
                    }

                    const tempF = Math.round(parseFloat(currentCondition.temp_F));
                    const description = currentCondition.weatherDesc[0].value;

                    // Weather icon mapping based on weather codes
                    const getWeatherIcon = (desc) => {
                        const lower = desc.toLowerCase();
                        if (lower.includes('sunny') || lower.includes('clear')) return 'â˜€ï¸';
                        if (lower.includes('cloud')) return 'â˜ï¸';
                        if (lower.includes('rain')) return 'ðŸŒ§ï¸';
                        if (lower.includes('snow')) return 'â„ï¸';
                        if (lower.includes('storm') || lower.includes('thunder')) return 'â›ˆï¸';
                        if (lower.includes('drizzle') || lower.includes('mist')) return 'ðŸŒ¦ï¸';
                        if (lower.includes('fog')) return 'ðŸŒ«ï¸';
                        return 'ðŸŒ¤ï¸';
                    };

                    // Clothing suggestions based on temp
                    let clothing = '';
                    if (tempF < 32) clothing = 'Heavy coat, hat, and gloves!';
                    else if (tempF < 50) clothing = 'Jacket or sweater recommended';
                    else if (tempF < 65) clothing = 'Light jacket might be nice';
                    else if (tempF < 80) clothing = 'Perfect weather, dress comfortably!';
                    else clothing = 'Stay cool, light clothing!';

                    // Get tomorrow's forecast
                    let tomorrowForecast = null;
                    if (data.weather && data.weather[1]) {
                        const tomorrow = data.weather[1];
                        const tomorrowMaxF = Math.round(parseFloat(tomorrow.maxtempF));
                        const tomorrowMinF = Math.round(parseFloat(tomorrow.mintempF));
                        const tomorrowDesc = tomorrow.hourly?.[4]?.weatherDesc?.[0]?.value || 'Conditions vary';

                        tomorrowForecast = {
                            maxTemp: tomorrowMaxF,
                            minTemp: tomorrowMinF,
                            description: tomorrowDesc,
                            icon: getWeatherIcon(tomorrowDesc)
                        };
                    }

                    const weatherData = {
                        temp: tempF,
                        description: description,
                        icon: getWeatherIcon(description),
                        clothing,
                        tomorrow: tomorrowForecast
                    };

                    // Cache for 30 minutes
                    try {
                        localStorage.setItem('weather_cache', JSON.stringify({
                            data: weatherData,
                            timestamp: Date.now()
                        }));
                    } catch (e) {
                        if (e.name === 'QuotaExceededError') {
                            console.warn('localStorage quota exceeded, clearing weather cache');
                            localStorage.removeItem('weather_cache');
                        }
                    }

                    setWeather(weatherData);
                    } catch (fetchError) {
                        clearTimeout(timeoutId);
                        throw fetchError;
                    }
                } catch (error) {
                    console.error('Error fetching weather:', error.name === 'AbortError' ? 'Weather API timeout' : error);
                    // Fallback data
                    setWeather({
                        temp: '--',
                        condition: 'Weather unavailable',
                        icon: 'ðŸŒ¤ï¸',
                        clothing: 'Check outside before heading out!'
                    });
                } finally {
                    setWeatherLoading(false);
                }
            };

            // Load player profile data
            const loadPlayerProfile = async (playerId) => {
                try {
                    // Get last 30 days of chore history
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);

                    const { data, error } = await supabase
                        .from('chore_completions')
                        .select(`
                            *,
                            chores(name, icon, base_value)
                        `)
                        .eq('player_id', playerId)
                        .gte('completed_date', thirtyDaysAgo.toISOString().split('T')[0])
                        .order('completed_date', { ascending: false });

                    if (error) throw error;

                    setPlayerHistory(data || []);
                } catch (error) {
                    console.error('Error loading player profile:', error);
                }
            };

            // Load monthly chores for all players
            const loadMonthlyChores = async () => {
                try {
                    // Get first day of current month
                    const now = new Date();
                    const firstDayOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                    const firstDayStr = firstDayOfMonth.toISOString().split('T')[0];

                    const { data, error } = await supabase
                        .from('chore_completions')
                        .select(`
                            *,
                            chores(name, icon),
                            players(name, avatar_url)
                        `)
                        .eq('status', 'approved')
                        .gte('completed_date', firstDayStr)
                        .order('completed_date', { ascending: false });

                    if (error) throw error;

                    setMonthlyChores(data || []);
                } catch (error) {
                    console.error('Error loading monthly chores:', error);
                }
            };

            // Weekly reset function
            const performWeeklyReset = async () => {
                try {
                    // Record the reset
                    await supabase
                        .from('weekly_resets')
                        .insert([{
                            week_start_date: currentWeekStart
                        }]);

                    setNeedsWeeklyReset(false);
                    await loadAllCompletions();
                    await loadData(); // Refresh data

                    console.log('Weekly reset completed for week starting:', currentWeekStart);
                } catch (error) {
                    console.error('Error performing weekly reset:', error);
                }
            };

            // Load all completions for admin menu
            const loadAllCompletions = async () => {
                try {
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);

                    const { data, error } = await supabase
                        .from('chore_completions')
                        .select(`
                            *,
                            chores(name, icon),
                            players(name, avatar_url)
                        `)
                        .gte('completed_date', thirtyDaysAgo.toISOString().split('T')[0])
                        .order('completed_date', { ascending: false });

                    if (error) throw error;
                    setAllCompletions(data || []);
                } catch (error) {
                    console.error('Error loading completions:', error);
                }
            };

            // Load error logs for admin panel
            const loadErrorLogs = async () => {
                try {
                    // Get recent error logs
                    const { data: logs, error: logsError } = await supabase
                        .rpc('get_recent_error_logs', { limit_count: 50 });

                    if (logsError) throw logsError;
                    setErrorLogs(logs || []);

                    // Get error statistics
                    const { data: stats, error: statsError } = await supabase
                        .rpc('get_error_stats');

                    if (statsError) throw statsError;
                    setErrorStats(stats || []);
                } catch (error) {
                    console.error('Error loading error logs:', error);
                }
            };

            // Update chore completion date
            const updateChoreDate = async (completionId, newDate) => {
                try {
                    const { error } = await supabase
                        .from('chore_completions')
                        .update({ completed_date: newDate })
                        .eq('id', completionId);

                    if (error) throw error;

                    haptic('success');
                    alert('âœ… Chore date updated!');
                    await loadAllCompletions();
                    await loadData();
                } catch (error) {
                    console.error('Error updating chore date:', error);
                    haptic('error');
                    alert(`Error updating date: ${error.message || 'Unknown error'}`);
                }
            };

            // Add backfill chore entry
            const addBackfillChore = async (playerId, choreId, date, points) => {
                try {
                    const { error } = await supabase
                        .from('chore_completions')
                        .insert([{
                            player_id: playerId,
                            chore_id: choreId,
                            completed_date: date,
                            value_awarded: points,
                            status: 'approved', // Auto-approve backfilled entries
                            completed_at: new Date().toISOString()
                        }]);

                    if (error) throw error;

                    haptic('success');
                    alert('âœ… Backfill entry added!');
                    await loadAllCompletions();
                    await loadData();
                } catch (error) {
                    console.error('Error adding backfill:', error);
                    haptic('error');
                    alert(`Error adding backfill: ${error.message || 'Unknown error'}`);
                }
            };

            // Calculate tiered payout (Option B)
            const calculateTieredPayout = (weeklyPoints, payoutTier = 'B') => {
                if (payoutTier !== 'B') {
                    // Option C will be implemented later
                    return { total: 0, breakdown: [] };
                }

                let payout = 0;
                const breakdown = [];

                // Tier 1: First 500 points at $0.01 per point (max $5.00)
                const tier1Points = Math.min(weeklyPoints, 500);
                if (tier1Points > 0) {
                    const tier1Payout = tier1Points * 0.01;
                    payout += tier1Payout;
                    breakdown.push({
                        tier: 1,
                        points: tier1Points,
                        rate: '$0.01/pt',
                        amount: tier1Payout
                    });
                }

                // Tier 2: Points 501-1000 at $0.008 per point (max $4.00)
                if (weeklyPoints > 500) {
                    const tier2Points = Math.min(weeklyPoints - 500, 500);
                    const tier2Payout = tier2Points * 0.008;
                    payout += tier2Payout;
                    breakdown.push({
                        tier: 2,
                        points: tier2Points,
                        rate: '$0.008/pt',
                        amount: tier2Payout
                    });
                }

                // Tier 3: Points 1000+ at $0.005 per point (no cap)
                if (weeklyPoints > 1000) {
                    const tier3Points = weeklyPoints - 1000;
                    const tier3Payout = tier3Points * 0.005;
                    payout += tier3Payout;
                    breakdown.push({
                        tier: 3,
                        points: tier3Points,
                        rate: '$0.005/pt',
                        amount: tier3Payout
                    });
                }

                return {
                    total: Math.round(payout * 100) / 100, // Round to 2 decimals
                    breakdown
                };
            };

            // Capture device and browser information
            const getDeviceInfo = () => {
                return {
                    browser: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    screenWidth: window.screen.width,
                    screenHeight: window.screen.height,
                    viewport: {
                        width: window.innerWidth,
                        height: window.innerHeight
                    },
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    timestamp: new Date().toISOString()
                };
            };

            // Log error to database
            const logError = async (errorType, errorMessage, userInput = null) => {
                try {
                    const deviceInfo = getDeviceInfo();

                    await supabase
                        .from('error_logs')
                        .insert({
                            error_type: errorType,
                            error_message: errorMessage,
                            user_input: userInput,
                            device_info: deviceInfo,
                            ip_address: null, // Will be captured by Supabase
                            user_agent: navigator.userAgent
                        });
                } catch (err) {
                    // Silent fail - don't show error to user
                    console.error('Error logging failed:', err);
                }
            };

            // Check if chore is available based on cooldown
            const getChoreAvailability = (chore, playerId = null) => {
                // Find the most recent completion of this chore
                // If playerId provided, check per-player cooldown; otherwise check global
                const lastCompletion = playerId
                    ? allCompletions.find(c => c.chore_id === chore.id && c.player_id === playerId)
                    : allCompletions.find(c => c.chore_id === chore.id);

                if (!lastCompletion) {
                    return { available: true, hoursRemaining: 0 };
                }

                const lastCompletedAt = new Date(lastCompletion.completed_at);
                const now = new Date();
                const hoursSinceCompletion = (now - lastCompletedAt) / (1000 * 60 * 60);
                const cooldownHours = chore.cooldown_hours || 24;

                if (hoursSinceCompletion >= cooldownHours) {
                    return { available: true, hoursRemaining: 0 };
                }

                const hoursRemaining = Math.ceil(cooldownHours - hoursSinceCompletion);
                return { available: false, hoursRemaining };
            };

            const claimChore = async (playerId, chore) => {
                try {
                    // Check cooldown first (per-player cooldown)
                    const availability = getChoreAvailability(chore, playerId);
                    if (!availability.available) {
                        const days = Math.floor(availability.hoursRemaining / 24);
                        const hours = availability.hoursRemaining % 24;
                        let timeText = '';
                        if (days > 0) {
                            timeText = days === 1 ? '1 day' : `${days} days`;
                            if (hours > 0) timeText += ` ${hours}h`;
                        } else {
                            timeText = hours === 1 ? '1 hour' : `${hours} hours`;
                        }
                        haptic('error');
                        alert(`â³ This chore is on cooldown! Available in ${timeText}.`);
                        return;
                    }

                    // Check if player already did this chore today
                    const today = new Date().toISOString().split('T')[0];
                    const { data: existing } = await supabase
                        .from('chore_completions')
                        .select('*')
                        .eq('player_id', playerId)
                        .eq('chore_id', chore.id)
                        .eq('completed_date', today);

                    if (existing && existing.length > 0) {
                        haptic('error');
                        alert('âš ï¸ This chore was already done today!');
                        return;
                    }

                    // High-value chores (>500 pts) can't be done more than once every 3 days
                    // Exception: "Clean Room" can be done daily per player
                    if (chore.points > 500 && chore.name !== 'Clean Room') {
                        const threeDaysAgo = new Date();
                        threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
                        const threeDaysAgoStr = threeDaysAgo.toISOString().split('T')[0];

                        const { data: recentHigh } = await supabase
                            .from('chore_completions')
                            .select('completed_date')
                            .eq('player_id', playerId)
                            .eq('chore_id', chore.id)
                            .gte('completed_date', threeDaysAgoStr)
                            .order('completed_date', { ascending: false })
                            .limit(1);

                        if (recentHigh && recentHigh.length > 0) {
                            const lastDate = new Date(recentHigh[0].completed_date);
                            const daysSince = Math.floor((new Date(today) - lastDate) / (1000 * 60 * 60 * 24));
                            const daysRemaining = 3 - daysSince;
                            haptic('error');
                            alert(`âš ï¸ High-value chore! You must wait ${daysRemaining} more day${daysRemaining === 1 ? '' : 's'} before doing this again.`);
                            return;
                        }
                    }

                    // Insert chore completion
                    const { data, error } = await supabase
                        .from('chore_completions')
                        .insert([{
                            player_id: playerId,
                            chore_id: chore.id,
                            completed_date: today,
                            value_awarded: chore.points,
                            status: 'pending'
                        }])
                        .select(`
                            *,
                            players(name),
                            chores(name, icon)
                        `)
                        .single();

                    if (error) throw error;

                    // Add to local pending state
                    setPendingChores(prev => [...prev, {
                        id: data.id,
                        playerId: data.player_id,
                        choreId: data.chore_id,
                        choreName: data.chores?.name || 'Unknown Chore',
                        points: data.value_awarded,
                        icon: data.chores?.icon || 'â“',
                        status: 'pending',
                        timestamp: new Date(data.completed_at)
                    }]);

                    haptic('success');
                    alert(`âœ… Chore claimed! Waiting for approval.`);
                } catch (error) {
                    console.error('Error claiming chore:', error);
                    haptic('error');
                    alert(`Error claiming chore: ${error.message || 'Unknown error'}`);
                }
            };


            const approveChore = async (choreId, code) => {
                if (code !== APPROVAL_CODE) {
                    haptic('error');
                    alert('âŒ Invalid admin code');
                    return;
                }

                try {
                    // Get chore details before updating
                    const { data: choreCompletion } = await supabase
                        .from('chore_completions')
                        .select('player_id, completed_at, value_awarded')
                        .eq('id', choreId)
                        .single();

                    // Update chore completion status to approved
                    const { error } = await supabase
                        .from('chore_completions')
                        .update({ status: 'approved' })
                        .eq('id', choreId);

                    if (error) throw error;

                    // Update player stats and check achievements
                    if (choreCompletion) {
                        await updatePlayerStats(
                            choreCompletion.player_id,
                            choreCompletion.completed_at,
                            choreCompletion.value_awarded
                        );
                    }

                    // Remove from pending list
                    setPendingChores(prev => prev.filter(c => c.id !== choreId));
                    setShowApproval(null);
                    setApprovalCode('');

                    // Reload data to update points
                    await loadData();

                    haptic('success');
                    alert('âœ… Chore approved!');
                } catch (error) {
                    console.error('Error approving chore:', error);
                    haptic('error');
                    alert(`Error approving chore: ${error.message || 'Unknown error'}`);
                }
            };

            const rejectChore = async (choreId) => {
                try {
                    // Update chore completion status to rejected
                    const { error } = await supabase
                        .from('chore_completions')
                        .update({ status: 'rejected' })
                        .eq('id', choreId);

                    if (error) throw error;

                    // Remove from pending list
                    setPendingChores(prev => prev.filter(c => c.id !== choreId));
                    setShowApproval(null);
                    setApprovalCode('');

                    haptic('medium');
                    alert('âŒ Chore rejected');
                } catch (error) {
                    console.error('Error rejecting chore:', error);
                    haptic('error');
                    alert(`Error rejecting chore: ${error.message || 'Unknown error'}`);
                }
            };

            const createTask = async () => {
                if (!newTaskName.trim() || newTaskPoints <= 0) {
                    haptic('error');
                    alert('Please enter a task name and point value');
                    return;
                }

                const code = prompt('Enter admin code to create custom task:');
                if (code !== APPROVAL_CODE) {
                    if (code !== null) {
                        haptic('error');
                        alert('âŒ Invalid admin code');
                    }
                    return;
                }

                try {
                    // Store due date in description as JSON
                    const description = newTaskDueDate ? JSON.stringify({ due_date: newTaskDueDate }) : null;

                    const { data, error } = await supabase
                        .from('chores')
                        .insert([{
                            name: newTaskName,
                            base_value: parseInt(newTaskPoints),
                            description: description,
                            icon: 'â­',
                            is_active: true,
                            max_per_day: 1
                        }])
                        .select()
                        .single();

                    if (error) throw error;

                    // Add to chores list
                    setChores(prev => [...prev, {
                        id: data.id,
                        name: data.name,
                        points: data.base_value,
                        icon: data.icon,
                        max_per_day: data.max_per_day,
                        description: data.description
                    }]);

                    setNewTaskName('');
                    setNewTaskPoints('');
                    setNewTaskDueDate('');
                    haptic('success');
                    alert('âœ… Custom task created!');
                } catch (error) {
                    console.error('Error creating task:', error);
                    haptic('error');
                    alert(`Error creating custom task: ${error.message || 'Unknown error'}`);
                }
            };

            const payoutDate = getLastFridayOfMonth();

            if (loading) {
                return (
                    <div style={{
                        minHeight: '100vh',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        background: theme.bg,
                        color: theme.text,
                        fontSize: '1.5rem'
                    }}>
                        Loading...
                    </div>
                );
            }

            // Admin Menu View
            if (showAdminMenu) {
                return (
                    <div style={{
                        minHeight: '100vh',
                        background: theme.bg,
                        color: theme.text,
                        padding: '16px'
                    }}>
                        {/* Header with Back Button */}
                        <div className="elevation-2" style={{
                            display: 'flex',
                            alignItems: 'center',
                            gap: '16px',
                            padding: '12px 20px',
                            marginBottom: '24px',
                            
                            margin: '0 auto 24px',
                            background: theme.surface,
                            borderRadius: '16px',
                            height: '56px'
                        }}>
                            <button
                                onClick={() => {
                                    setShowAdminMenu(false);
                                    setEditingChore(null);
                                }}
                                className="fab elevation-1 ripple"
                                style={{
                                    background: theme.primary,
                                    color: theme.onPrimary,
                                    width: '48px',
                                    height: '48px',
                                    fontSize: '1.25rem'
                                }}
                            >
                                â†
                            </button>
                            <h1 style={{
                                fontSize: '1.375rem',
                                fontWeight: '500',
                                margin: 0,
                                fontFamily: "'Google Sans Display', sans-serif"
                            }}>
                                âœï¸ Edit Approved Task
                            </h1>
                        </div>

                        <div style={{  margin: '0 auto' }}>
                            {/* Add Backfill Entry */}
                            <div className="material-card elevation-1" style={{
                                padding: '20px',
                                background: theme.cardBg,
                                marginBottom: '24px'
                            }}>
                                <h2 style={{
                                    fontSize: '1.125rem',
                                    fontWeight: '500',
                                    marginBottom: '16px',
                                    color: theme.cardText
                                }}>
                                    âž• Add Backfill Entry
                                </h2>
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                                    <select
                                        id="backfill-player"
                                        style={{
                                            padding: '12px',
                                            borderRadius: '8px',
                                            border: `1px solid ${theme.outline}`,
                                            background: theme.surface,
                                            color: theme.text,
                                            fontSize: '1rem'
                                        }}
                                    >
                                        <option value="">Select Player</option>
                                        {players.map(player => (
                                            <option key={player.id} value={player.id}>
                                                {player.name}
                                            </option>
                                        ))}
                                    </select>
                                    <select
                                        id="backfill-chore"
                                        style={{
                                            padding: '12px',
                                            borderRadius: '8px',
                                            border: `1px solid ${theme.outline}`,
                                            background: theme.surface,
                                            color: theme.text,
                                            fontSize: '1rem'
                                        }}
                                    >
                                        <option value="">Select Chore</option>
                                        {chores.map(chore => (
                                            <option key={chore.id} value={JSON.stringify({id: chore.id, points: chore.points})}>
                                                {chore.icon} {chore.name} ({chore.points} pts)
                                            </option>
                                        ))}
                                    </select>
                                    <input
                                        id="backfill-date"
                                        type="date"
                                        max={new Date().toISOString().split('T')[0]}
                                        style={{
                                            padding: '12px',
                                            borderRadius: '8px',
                                            border: `1px solid ${theme.outline}`,
                                            background: theme.surface,
                                            color: theme.text,
                                            fontSize: '1rem'
                                        }}
                                    />
                                    <button
                                        className="material-button ripple"
                                        onClick={() => {
                                            const playerId = document.getElementById('backfill-player').value;
                                            const choreData = document.getElementById('backfill-chore').value;
                                            const date = document.getElementById('backfill-date').value;

                                            if (!playerId || !choreData || !date) {
                                                haptic('error');
                                                alert('âŒ Please fill in all fields');
                                                return;
                                            }

                                            const {id: choreId, points} = JSON.parse(choreData);

                                            if (confirm(`Add backfill entry for ${date}?`)) {
                                                addBackfillChore(playerId, choreId, date, points);
                                            }
                                        }}
                                        style={{
                                            background: theme.success,
                                            color: '#FFFFFF',
                                            padding: '12px'
                                        }}
                                    >
                                        Add Backfill Entry
                                    </button>
                                </div>
                            </div>

                            {/* Error Logs & Security */}
                            <div className="material-card elevation-1" style={{
                                padding: '20px',
                                background: theme.cardBg,
                                marginBottom: '24px',
                                border: '2px solid #EF5350'
                            }}>
                                <h2 style={{
                                    fontSize: '1.125rem',
                                    fontWeight: '500',
                                    marginBottom: '16px',
                                    color: theme.cardText
                                }}>
                                    ðŸ”’ Security & Error Logs
                                </h2>

                                {/* Error Statistics */}
                                {errorStats.length > 0 && (
                                    <div style={{
                                        marginBottom: '20px',
                                        padding: '12px',
                                        background: darkMode ? 'rgba(239, 83, 80, 0.1)' : 'rgba(239, 83, 80, 0.05)',
                                        borderRadius: '8px'
                                    }}>
                                        <div style={{
                                            fontSize: '0.875rem',
                                            fontWeight: '600',
                                            marginBottom: '8px',
                                            color: theme.cardText
                                        }}>
                                            ðŸ“Š Error Summary
                                        </div>
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '6px' }}>
                                            {errorStats.map((stat, idx) => (
                                                <div key={idx} style={{
                                                    display: 'flex',
                                                    justifyContent: 'space-between',
                                                    fontSize: '0.8125rem',
                                                    color: theme.textSecondary
                                                }}>
                                                    <span style={{ textTransform: 'capitalize' }}>
                                                        {stat.error_type.replace('_', ' ')}:
                                                    </span>
                                                    <span style={{ fontWeight: '600', color: '#EF5350' }}>
                                                        {stat.count} occurrences
                                                    </span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* Recent Error Logs */}
                                <div style={{
                                    fontSize: '0.875rem',
                                    fontWeight: '600',
                                    marginBottom: '12px',
                                    color: theme.cardText
                                }}>
                                    ðŸ“‹ Recent Events (Last 50)
                                </div>

                                {errorLogs.length === 0 ? (
                                    <div style={{
                                        textAlign: 'center',
                                        padding: '32px',
                                        color: theme.textSecondary
                                    }}>
                                        âœ… No errors logged yet
                                    </div>
                                ) : (
                                    <div style={{
                                        maxHeight: '400px',
                                        overflowY: 'auto',
                                        display: 'flex',
                                        flexDirection: 'column',
                                        gap: '8px'
                                    }}>
                                        {errorLogs.map(log => (
                                            <div key={log.id} style={{
                                                padding: '12px',
                                                background: theme.surface,
                                                borderRadius: '8px',
                                                borderLeft: `4px solid ${
                                                    log.error_type === 'login_failed' ? '#FF9800' :
                                                    log.error_type === 'admin_failed' ? '#EF5350' :
                                                    '#9E9E9E'
                                                }`
                                            }}>
                                                <div style={{
                                                    display: 'flex',
                                                    justifyContent: 'space-between',
                                                    alignItems: 'flex-start',
                                                    marginBottom: '8px'
                                                }}>
                                                    <div style={{
                                                        fontSize: '0.8125rem',
                                                        fontWeight: '600',
                                                        color: theme.cardText,
                                                        textTransform: 'capitalize'
                                                    }}>
                                                        {log.error_type === 'login_failed' ? 'âš ï¸ Failed Login' :
                                                         log.error_type === 'admin_failed' ? 'ðŸš¨ Failed Admin Access' :
                                                         'âŒ ' + log.error_type.replace('_', ' ')}
                                                    </div>
                                                    <div style={{
                                                        fontSize: '0.75rem',
                                                        color: theme.textSecondary
                                                    }}>
                                                        {new Date(log.logged_at).toLocaleString()}
                                                    </div>
                                                </div>

                                                {log.error_message && (
                                                    <div style={{
                                                        fontSize: '0.8125rem',
                                                        color: theme.textSecondary,
                                                        marginBottom: '6px'
                                                    }}>
                                                        {log.error_message}
                                                    </div>
                                                )}

                                                {log.user_input && (
                                                    <div style={{
                                                        fontSize: '0.75rem',
                                                        color: '#EF5350',
                                                        fontFamily: 'monospace',
                                                        padding: '4px 8px',
                                                        background: darkMode ? 'rgba(239, 83, 80, 0.1)' : 'rgba(239, 83, 80, 0.05)',
                                                        borderRadius: '4px',
                                                        marginBottom: '6px'
                                                    }}>
                                                        Attempted: "{log.user_input}"
                                                    </div>
                                                )}

                                                {log.device_info && (
                                                    <details style={{
                                                        fontSize: '0.75rem',
                                                        color: theme.textSecondary,
                                                        marginTop: '8px'
                                                    }}>
                                                        <summary style={{ cursor: 'pointer', marginBottom: '4px' }}>
                                                            Device Info
                                                        </summary>
                                                        <div style={{
                                                            fontFamily: 'monospace',
                                                            fontSize: '0.6875rem',
                                                            padding: '8px',
                                                            background: darkMode ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.05)',
                                                            borderRadius: '4px',
                                                            whiteSpace: 'pre-wrap',
                                                            wordBreak: 'break-word'
                                                        }}>
                                                            Platform: {log.device_info.platform}<br />
                                                            Language: {log.device_info.language}<br />
                                                            Screen: {log.device_info.screenWidth}x{log.device_info.screenHeight}<br />
                                                            Timezone: {log.device_info.timezone}
                                                        </div>
                                                    </details>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>

                            {/* Recent Completions */}
                            <div className="material-card elevation-1" style={{
                                padding: '20px',
                                background: theme.cardBg
                            }}>
                                <h2 style={{
                                    fontSize: '1.125rem',
                                    fontWeight: '500',
                                    marginBottom: '16px',
                                    color: theme.cardText
                                }}>
                                    ðŸ“ Recent Completions (Last 30 Days)
                                </h2>
                                {allCompletions.length === 0 ? (
                                    <div style={{
                                        textAlign: 'center',
                                        padding: '32px',
                                        color: theme.textSecondary
                                    }}>
                                        No completions found
                                    </div>
                                ) : (
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                                        {allCompletions.map(completion => (
                                            <div key={completion.id} className="material-card" style={{
                                                padding: '16px',
                                                background: theme.surface,
                                                borderLeft: `4px solid ${
                                                    completion.status === 'pending' ? '#FFA726' :
                                                    completion.status === 'approved' ? '#66BB6A' : '#EF5350'
                                                }`
                                            }}>
                                                <div style={{
                                                    display: 'flex',
                                                    justifyContent: 'space-between',
                                                    alignItems: 'flex-start',
                                                    gap: '12px'
                                                }}>
                                                    <div style={{ flex: 1 }}>
                                                        <div style={{
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            gap: '8px',
                                                            marginBottom: '8px'
                                                        }}>
                                                            <span style={{ fontSize: '1.5rem' }}>
                                                                {completion.players?.avatar_url || 'ðŸ‘¤'}
                                                            </span>
                                                            <span style={{ fontSize: '1.25rem' }}>
                                                                {completion.chores?.icon || 'â“'}
                                                            </span>
                                                            <div>
                                                                <div style={{
                                                                    fontWeight: '500',
                                                                    color: theme.cardText
                                                                }}>
                                                                    {completion.players?.name || 'Unknown'}: {completion.chores?.name || 'Unknown'}
                                                                </div>
                                                                <div style={{
                                                                    fontSize: '0.875rem',
                                                                    color: theme.textSecondary
                                                                }}>
                                                                    {completion.value_awarded} pts â€¢ {completion.status}
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div style={{
                                                            fontSize: '0.875rem',
                                                            color: theme.textSecondary
                                                        }}>
                                                            Date: {new Date(completion.completed_date).toLocaleDateString('en-US', {
                                                                weekday: 'short',
                                                                month: 'short',
                                                                day: 'numeric',
                                                                year: 'numeric'
                                                            })}
                                                        </div>
                                                    </div>
                                                    <button
                                                        className="material-button ripple"
                                                        onClick={() => {
                                                            const newDate = prompt(
                                                                'Enter new date (YYYY-MM-DD):',
                                                                completion.completed_date
                                                            );
                                                            if (newDate && newDate !== completion.completed_date) {
                                                                if (confirm(`Change date from ${completion.completed_date} to ${newDate}?`)) {
                                                                    updateChoreDate(completion.id, newDate);
                                                                }
                                                            }
                                                        }}
                                                        style={{
                                                            background: theme.primary,
                                                            color: theme.onPrimary,
                                                            padding: '8px 16px',
                                                            fontSize: '0.875rem'
                                                        }}
                                                    >
                                                        Edit Date
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // Monthly View
            if (showMonthlyView) {
                // Group chores by date
                const choresByDate = {};
                monthlyChores.forEach(chore => {
                    const date = chore.completed_date;
                    if (!choresByDate[date]) {
                        choresByDate[date] = [];
                    }
                    choresByDate[date].push(chore);
                });

                const dates = Object.keys(choresByDate).sort((a, b) => new Date(b) - new Date(a));

                // Get current month name
                const monthName = new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

                return (
                    <div style={{
                        minHeight: '100vh',
                        background: theme.bg,
                        color: theme.text,
                        padding: '16px'
                    }}>
                        {/* Header with Back Button */}
                        <div className="elevation-2" style={{
                            display: 'flex',
                            alignItems: 'center',
                            gap: '16px',
                            padding: '12px 20px',
                            marginBottom: '24px',
                            
                            margin: '0 auto 24px',
                            background: theme.surface,
                            borderRadius: '16px',
                            height: '56px'
                        }}>
                            <button
                                onClick={() => setShowMonthlyView(false)}
                                className="fab elevation-1 ripple"
                                style={{
                                    background: theme.primary,
                                    color: theme.onPrimary,
                                    width: '48px',
                                    height: '48px',
                                    fontSize: '1.25rem'
                                }}
                            >
                                â†
                            </button>
                            <h1 style={{
                                fontSize: '1.375rem',
                                fontWeight: '500',
                                margin: 0,
                                fontFamily: "'Google Sans Display', sans-serif"
                            }}>
                                ðŸ“… {monthName}
                            </h1>
                        </div>

                        <div style={{  margin: '0 auto' }}>
                            {dates.length === 0 ? (
                                <div className="material-card elevation-1" style={{
                                    padding: '48px',
                                    background: theme.cardBg,
                                    textAlign: 'center'
                                }}>
                                    <div style={{
                                        fontSize: '3rem',
                                        marginBottom: '16px'
                                    }}>
                                        ðŸ“­
                                    </div>
                                    <div style={{
                                        fontSize: '1.125rem',
                                        color: theme.textSecondary
                                    }}>
                                        No chores completed this month yet
                                    </div>
                                </div>
                            ) : (
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                                    {dates.map(date => {
                                        const dayChores = choresByDate[date];
                                        const totalPoints = dayChores.reduce((sum, c) => sum + c.value_awarded, 0);

                                        return (
                                            <div key={date} className="material-card elevation-1" style={{
                                                padding: '20px',
                                                background: theme.cardBg
                                            }}>
                                                <div style={{
                                                    display: 'flex',
                                                    justifyContent: 'space-between',
                                                    alignItems: 'center',
                                                    marginBottom: '16px',
                                                    paddingBottom: '12px',
                                                    borderBottom: `2px solid ${theme.outline}`
                                                }}>
                                                    <div style={{
                                                        fontSize: '1.125rem',
                                                        fontWeight: '600',
                                                        color: theme.cardText
                                                    }}>
                                                        {new Date(date).toLocaleDateString('en-US', {
                                                            weekday: 'long',
                                                            month: 'long',
                                                            day: 'numeric'
                                                        })}
                                                    </div>
                                                    <div style={{
                                                        fontSize: '1.25rem',
                                                        fontWeight: '700',
                                                        color: theme.primary
                                                    }}>
                                                        {totalPoints} pts
                                                    </div>
                                                </div>

                                                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                                                    {dayChores.map(chore => (
                                                        <div key={chore.id} style={{
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            gap: '12px',
                                                            padding: '12px',
                                                            background: theme.surface,
                                                            borderRadius: '12px'
                                                        }}>
                                                            <div style={{ fontSize: '2rem' }}>
                                                                {chore.players?.avatar_url || 'ðŸ‘¤'}
                                                            </div>
                                                            <div style={{ fontSize: '1.5rem' }}>
                                                                {chore.chores?.icon || 'â“'}
                                                            </div>
                                                            <div style={{ flex: 1 }}>
                                                                <div style={{
                                                                    fontWeight: '500',
                                                                    color: theme.cardText,
                                                                    marginBottom: '2px'
                                                                }}>
                                                                    {chore.players?.name || 'Unknown'}: {chore.chores?.name || 'Unknown Chore'}
                                                                </div>
                                                            </div>
                                                            <div style={{
                                                                fontWeight: '600',
                                                                fontSize: '1.125rem',
                                                                color: theme.primary
                                                            }}>
                                                                +{chore.value_awarded}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            // Profile Page View
            if (showProfile && selectedPlayer) {
                const approvedHistory = playerHistory.filter(h => h.status === 'approved');
                const last7Days = approvedHistory.slice(0, 7);

                // Group by date for daily totals
                const dailyTotals = {};
                approvedHistory.forEach(h => {
                    const date = h.completed_date;
                    if (!dailyTotals[date]) {
                        dailyTotals[date] = { date, points: 0, chores: [] };
                    }
                    dailyTotals[date].points += h.value_awarded;
                    dailyTotals[date].chores.push(h);
                });

                const dailyData = Object.values(dailyTotals).sort((a, b) =>
                    new Date(b.date) - new Date(a.date)
                );

                return (
                    <div style={{
                        minHeight: '100vh',
                        background: theme.bg,
                        color: theme.text,
                        padding: '16px'
                    }}>
                        {/* Header with Back Button */}
                        <div className="elevation-2" style={{
                            display: 'flex',
                            alignItems: 'center',
                            gap: '16px',
                            padding: '12px 20px',
                            marginBottom: '24px',
                            
                            margin: '0 auto 24px',
                            background: theme.surface,
                            borderRadius: '16px',
                            height: '56px'
                        }}>
                            <button
                                onClick={() => setShowProfile(false)}
                                className="fab elevation-1 ripple"
                                style={{
                                    background: theme.primary,
                                    color: theme.onPrimary,
                                    width: '48px',
                                    height: '48px',
                                    fontSize: '1.25rem'
                                }}
                            >
                                â†
                            </button>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '12px', flex: 1 }}>
                                <div style={{ fontSize: '2rem' }}>{selectedPlayer.avatar}</div>
                                <h1 style={{
                                    fontSize: '1.375rem',
                                    fontWeight: '500',
                                    margin: 0,
                                    fontFamily: "'Google Sans Display', sans-serif"
                                }}>
                                    {selectedPlayer.name}'s Profile
                                </h1>
                            </div>
                        </div>

                        <div style={{  margin: '0 auto' }}>
                            {/* Stats Grid */}
                            <div style={{
                                display: 'grid',
                                gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                                gap: '16px',
                                marginBottom: '24px'
                            }}>
                                {/* Weekly Total */}
                                <div className="material-card elevation-1" style={{
                                    padding: '16px',
                                    background: theme.cardBg,
                                    textAlign: 'center'
                                }}>
                                    <div style={{
                                        fontSize: '0.75rem',
                                        fontWeight: '500',
                                        textTransform: 'uppercase',
                                        color: theme.textSecondary,
                                        marginBottom: '8px'
                                    }}>
                                        This Week
                                    </div>
                                    <div style={{
                                        fontSize: '2rem',
                                        fontWeight: '600',
                                        color: theme.primary
                                    }}>
                                        {selectedPlayer.points.toLocaleString()}
                                    </div>
                                    <div style={{ fontSize: '0.875rem', color: theme.textSecondary }}>points</div>
                                </div>

                                {/* Personal Best */}
                                <div className="material-card elevation-1" style={{
                                    padding: '16px',
                                    background: theme.cardBg,
                                    textAlign: 'center'
                                }}>
                                    <div style={{
                                        fontSize: '0.75rem',
                                        fontWeight: '500',
                                        textTransform: 'uppercase',
                                        color: theme.textSecondary,
                                        marginBottom: '8px'
                                    }}>
                                        Personal Best
                                    </div>
                                    <div style={{
                                        fontSize: '2rem',
                                        fontWeight: '600',
                                        color: theme.accent
                                    }}>
                                        {(selectedPlayer.best_week_total || 0).toLocaleString()}
                                    </div>
                                    <div style={{ fontSize: '0.875rem', color: theme.textSecondary }}>points</div>
                                </div>

                                {/* Total Chores */}
                                <div className="material-card elevation-1" style={{
                                    padding: '16px',
                                    background: theme.cardBg,
                                    textAlign: 'center'
                                }}>
                                    <div style={{
                                        fontSize: '0.75rem',
                                        fontWeight: '500',
                                        textTransform: 'uppercase',
                                        color: theme.textSecondary,
                                        marginBottom: '8px'
                                    }}>
                                        Total Chores
                                    </div>
                                    <div style={{
                                        fontSize: '2rem',
                                        fontWeight: '600',
                                        color: theme.success
                                    }}>
                                        {selectedPlayer.completedChores}
                                    </div>
                                    <div style={{ fontSize: '0.875rem', color: theme.textSecondary }}>completed</div>
                                </div>

                                {/* Weekly Payout */}
                                <div className="material-card elevation-1" style={{
                                    padding: '16px',
                                    background: theme.cardBg,
                                    textAlign: 'center'
                                }}>
                                    <div style={{
                                        fontSize: '0.75rem',
                                        fontWeight: '500',
                                        textTransform: 'uppercase',
                                        color: theme.textSecondary,
                                        marginBottom: '8px'
                                    }}>
                                        Weekly Payout
                                    </div>
                                    <div style={{
                                        fontSize: '2rem',
                                        fontWeight: '600',
                                        color: '#2E7D32'
                                    }}>
                                        ${calculateTieredPayout(selectedPlayer.points).total.toFixed(2)}
                                    </div>
                                    <div style={{
                                        fontSize: '0.75rem',
                                        color: theme.textSecondary,
                                        marginTop: '4px'
                                    }}>
                                        {payoutDate}
                                    </div>
                                </div>
                            </div>

                            {/* Payout Breakdown */}
                            {(() => {
                                const payout = calculateTieredPayout(selectedPlayer.points);
                                if (payout.breakdown.length > 0) {
                                    return (
                                        <div className="material-card elevation-1" style={{
                                            padding: '16px',
                                            background: theme.cardBg,
                                            marginBottom: '16px'
                                        }}>
                                            <div style={{
                                                fontSize: '1rem',
                                                fontWeight: '600',
                                                marginBottom: '12px',
                                                color: theme.cardText
                                            }}>
                                                ðŸ’µ Payout Breakdown
                                            </div>
                                            {payout.breakdown.map((tier, idx) => (
                                                <div key={idx} style={{
                                                    display: 'flex',
                                                    justifyContent: 'space-between',
                                                    alignItems: 'center',
                                                    padding: '8px',
                                                    marginBottom: '4px',
                                                    background: darkMode ? 'rgba(71, 178, 196, 0.05)' : 'rgba(208, 165, 0, 0.05)',
                                                    borderRadius: '6px'
                                                }}>
                                                    <div style={{ fontSize: '0.875rem', color: theme.cardText }}>
                                                        <strong>Tier {tier.tier}:</strong> {tier.points.toLocaleString()} pts @ {tier.rate}
                                                    </div>
                                                    <div style={{
                                                        fontSize: '0.875rem',
                                                        fontWeight: '600',
                                                        color: '#2E7D32'
                                                    }}>
                                                        ${tier.amount.toFixed(2)}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    );
                                }
                            })()}

                            {/* Achievements */}
                            <div className="material-card elevation-1" style={{
                                padding: '16px',
                                background: theme.cardBg,
                                marginBottom: '16px'
                            }}>
                                <h2 style={{
                                    fontSize: '1.25rem',
                                    fontWeight: '500',
                                    marginBottom: '16px',
                                    color: theme.cardText
                                }}>
                                    ðŸ† Achievements
                                </h2>
                                {(() => {
                                    const earned = playerAchievements[selectedPlayer.id] || [];
                                    const stats = playerStats[selectedPlayer.id];

                                    if (earned.length === 0) {
                                        return (
                                            <div style={{
                                                textAlign: 'center',
                                                padding: '32px',
                                                color: theme.textSecondary
                                            }}>
                                                No achievements earned yet. Keep completing chores!
                                            </div>
                                        );
                                    }

                                    // Group achievements by category
                                    const byCategory = {};
                                    earned.forEach(pa => {
                                        const achievement = achievements.find(a => a.id === pa.achievement_id);
                                        if (achievement) {
                                            if (!byCategory[achievement.category]) {
                                                byCategory[achievement.category] = [];
                                            }
                                            byCategory[achievement.category].push(achievement);
                                        }
                                    });

                                    const categoryNames = {
                                        chore_milestone: 'Chore Milestones',
                                        point_milestone: 'Point Milestones',
                                        weekly_performance: 'Weekly Performance',
                                        streak: 'Streaks',
                                        special: 'Special'
                                    };

                                    return (
                                        <div>
                                            {Object.entries(byCategory).map(([category, categoryAchievements]) => (
                                                <div key={category} style={{ marginBottom: '20px' }}>
                                                    <div style={{
                                                        fontSize: '0.875rem',
                                                        fontWeight: '600',
                                                        textTransform: 'uppercase',
                                                        letterSpacing: '0.5px',
                                                        color: theme.textSecondary,
                                                        marginBottom: '12px'
                                                    }}>
                                                        {categoryNames[category]}
                                                    </div>
                                                    <div style={{
                                                        display: 'grid',
                                                        gridTemplateColumns: 'repeat(auto-fill, minmax(120px, 1fr))',
                                                        gap: '12px'
                                                    }}>
                                                        {categoryAchievements.map(achievement => (
                                                            <div key={achievement.id} style={{
                                                                padding: '16px',
                                                                background: theme.surface,
                                                                borderRadius: '12px',
                                                                textAlign: 'center',
                                                                border: `2px solid ${theme.primary}`,
                                                                boxShadow: `0 0 12px ${darkMode ? 'rgba(71, 178, 196, 0.2)' : 'rgba(208, 165, 0, 0.2)'}`
                                                            }}>
                                                                <div style={{ fontSize: '2.5rem', marginBottom: '8px' }}>
                                                                    {achievement.icon}
                                                                </div>
                                                                <div style={{
                                                                    fontSize: '0.75rem',
                                                                    fontWeight: '600',
                                                                    color: theme.cardText,
                                                                    marginBottom: '4px'
                                                                }}>
                                                                    {achievement.name}
                                                                </div>
                                                                <div style={{
                                                                    fontSize: '0.6875rem',
                                                                    color: theme.textSecondary
                                                                }}>
                                                                    {achievement.description}
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            ))}

                                            {/* Stats Summary */}
                                            {stats && (
                                                <div style={{
                                                    marginTop: '20px',
                                                    padding: '16px',
                                                    background: theme.surface,
                                                    borderRadius: '12px'
                                                }}>
                                                    <div style={{
                                                        fontSize: '0.875rem',
                                                        fontWeight: '600',
                                                        color: theme.textSecondary,
                                                        marginBottom: '12px'
                                                    }}>
                                                        Progress Stats
                                                    </div>
                                                    <div style={{
                                                        display: 'grid',
                                                        gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))',
                                                        gap: '12px',
                                                        fontSize: '0.8125rem'
                                                    }}>
                                                        <div>
                                                            <span style={{ color: theme.textSecondary }}>Current Streak:</span>
                                                            <span style={{ fontWeight: '600', color: theme.primary, marginLeft: '4px' }}>
                                                                ðŸ”¥ {stats.current_streak || 0} days
                                                            </span>
                                                        </div>
                                                        <div>
                                                            <span style={{ color: theme.textSecondary }}>Longest Streak:</span>
                                                            <span style={{ fontWeight: '600', color: theme.accent, marginLeft: '4px' }}>
                                                                âš¡ {stats.longest_streak || 0} days
                                                            </span>
                                                        </div>
                                                        <div>
                                                            <span style={{ color: theme.textSecondary }}>GOAT Wins:</span>
                                                            <span style={{ fontWeight: '600', color: '#FFD700', marginLeft: '4px' }}>
                                                                ðŸ {stats.goat_wins || 0}
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })()}
                            </div>

                            {/* Last 7 Days */}
                            <div className="material-card elevation-1" style={{
                                padding: '16px',
                                background: theme.cardBg,
                                marginBottom: '16px'
                            }}>
                                <h2 style={{
                                    fontSize: '1.25rem',
                                    fontWeight: '500',
                                    marginBottom: '16px',
                                    color: theme.cardText
                                }}>
                                    Last 7 Days
                                </h2>
                                {last7Days.length === 0 ? (
                                    <div style={{
                                        textAlign: 'center',
                                        padding: '32px',
                                        color: theme.textSecondary
                                    }}>
                                        No completed chores in the last 7 days
                                    </div>
                                ) : (
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                                        {last7Days.map((chore) => (
                                            <div key={chore.id || chore.completed_at} style={{
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '12px',
                                                padding: '12px',
                                                background: theme.surface,
                                                borderRadius: '12px'
                                            }}>
                                                <div style={{ fontSize: '1.5rem' }}>{chore.chores?.icon || 'â“'}</div>
                                                <div style={{ flex: 1 }}>
                                                    <div style={{
                                                        fontWeight: '500',
                                                        color: theme.cardText
                                                    }}>
                                                        {chore.chores?.name || 'Unknown Chore'}
                                                    </div>
                                                    <div style={{
                                                        fontSize: '0.75rem',
                                                        color: theme.textSecondary
                                                    }}>
                                                        {new Date(chore.completed_date).toLocaleDateString('en-US', {
                                                            weekday: 'short',
                                                            month: 'short',
                                                            day: 'numeric'
                                                        })}
                                                    </div>
                                                </div>
                                                <div style={{
                                                    fontWeight: '600',
                                                    color: theme.primary
                                                }}>
                                                    +{chore.value_awarded}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>

                            {/* 30-Day Log */}
                            <div className="material-card elevation-1" style={{
                                padding: '20px',
                                background: theme.cardBg
                            }}>
                                <h2 style={{
                                    fontSize: '1.25rem',
                                    fontWeight: '500',
                                    marginBottom: '16px',
                                    color: theme.cardText
                                }}>
                                    30-Day History
                                </h2>
                                {dailyData.length === 0 ? (
                                    <div style={{
                                        textAlign: 'center',
                                        padding: '32px',
                                        color: theme.textSecondary
                                    }}>
                                        No chore history yet
                                    </div>
                                ) : (
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                                        {dailyData.map((day) => (
                                            <div key={day.date} className="material-card" style={{
                                                padding: '16px',
                                                background: theme.surface,
                                                borderLeft: `4px solid ${theme.primary}`
                                            }}>
                                                <div style={{
                                                    display: 'flex',
                                                    justifyContent: 'space-between',
                                                    alignItems: 'center',
                                                    marginBottom: '8px'
                                                }}>
                                                    <div style={{
                                                        fontWeight: '600',
                                                        color: theme.cardText
                                                    }}>
                                                        {new Date(day.date).toLocaleDateString('en-US', {
                                                            weekday: 'long',
                                                            month: 'long',
                                                            day: 'numeric'
                                                        })}
                                                    </div>
                                                    <div style={{
                                                        fontWeight: '700',
                                                        fontSize: '1.125rem',
                                                        color: theme.primary
                                                    }}>
                                                        {day.points} pts
                                                    </div>
                                                </div>
                                                <div style={{
                                                    fontSize: '0.875rem',
                                                    color: theme.textSecondary
                                                }}>
                                                    {day.chores.map(c => c.chores?.name || 'Unknown Chore').join(', ')}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // If not logged in, show login screen
            if (!isLoggedIn) {
                return (
                    <div style={{
                        minHeight: '100vh',
                        background: darkMode ? '#121212' : '#f5f5f5',
                        display: 'flex',
                        flexDirection: 'column',
                        justifyContent: 'center',
                        alignItems: 'center',
                        fontFamily: "'Google Sans', -apple-system, BlinkMacSystemFont, sans-serif"
                    }}>
                        <div className="material-card elevation-3" style={{
                            padding: '32px',
                            maxWidth: '400px',
                            width: '90%',
                            background: darkMode ? '#1E1E1E' : '#FFFFFF',
                            borderRadius: '20px',
                            textAlign: 'center'
                        }}>
                            <h1 style={{
                                fontSize: '2rem',
                                fontWeight: '500',
                                marginBottom: '8px',
                                color: darkMode ? '#E0E0E0' : '#202124'
                            }}>
                                GyattChores
                            </h1>
                            <p style={{
                                fontSize: '0.875rem',
                                color: darkMode ? '#9E9E9E' : '#5F6368',
                                marginBottom: '32px'
                            }}>
                                Family Chore Tracker
                            </p>

                            <form onSubmit={handleLogin}>
                                <div style={{ marginBottom: '24px', textAlign: 'left' }}>
                                    <label style={{
                                        display: 'block',
                                        fontSize: '0.875rem',
                                        fontWeight: '500',
                                        marginBottom: '8px',
                                        color: darkMode ? '#E0E0E0' : '#202124'
                                    }}>
                                        Password
                                    </label>
                                    <input
                                        type="password"
                                        value={loginPassword}
                                        onChange={(e) => setLoginPassword(e.target.value)}
                                        placeholder="Enter password"
                                        autoFocus
                                        style={{
                                            width: '100%',
                                            padding: '12px 16px',
                                            fontSize: '1rem',
                                            border: `1px solid ${darkMode ? '#333' : '#dadce0'}`,
                                            borderRadius: '8px',
                                            background: darkMode ? '#2C2C2C' : '#FFFFFF',
                                            color: darkMode ? '#E0E0E0' : '#202124',
                                            outline: 'none',
                                            transition: 'border-color 0.2s'
                                        }}
                                        onFocus={(e) => {
                                            e.target.style.borderColor = '#1a73e8';
                                        }}
                                        onBlur={(e) => {
                                            e.target.style.borderColor = darkMode ? '#333' : '#dadce0';
                                        }}
                                    />
                                </div>

                                {loginError && (
                                    <div style={{
                                        padding: '12px',
                                        marginBottom: '16px',
                                        background: 'rgba(244, 67, 54, 0.1)',
                                        border: '1px solid rgba(244, 67, 54, 0.3)',
                                        borderRadius: '8px',
                                        color: '#f44336',
                                        fontSize: '0.875rem'
                                    }}>
                                        {loginError}
                                    </div>
                                )}

                                <button
                                    type="submit"
                                    className="material-button elevation-1 ripple"
                                    style={{
                                        width: '100%',
                                        padding: '12px',
                                        fontSize: '1rem',
                                        fontWeight: '500',
                                        background: '#1a73e8',
                                        color: '#FFFFFF',
                                        border: 'none',
                                        borderRadius: '8px',
                                        cursor: 'pointer',
                                        transition: 'background 0.2s'
                                    }}
                                    onMouseEnter={(e) => {
                                        e.target.style.background = '#1557b0';
                                    }}
                                    onMouseLeave={(e) => {
                                        e.target.style.background = '#1a73e8';
                                    }}
                                >
                                    Login
                                </button>
                            </form>
                        </div>

                        {/* Development Story */}
                        <div className="material-card elevation-2" style={{
                            marginTop: '24px',
                            padding: '24px',
                            maxWidth: '600px',
                            width: '90%',
                            background: darkMode ? '#1E1E1E' : '#FFFFFF',
                            borderRadius: '16px',
                            textAlign: 'left'
                        }}>
                            <h2 style={{
                                fontSize: '1.25rem',
                                fontWeight: '500',
                                marginBottom: '16px',
                                color: darkMode ? '#E0E0E0' : '#202124'
                            }}>
                                ðŸ“– Built in 2 Days with My Kids
                            </h2>

                            <div style={{
                                fontSize: '0.9375rem',
                                lineHeight: '1.6',
                                color: darkMode ? '#B0B0B0' : '#5F6368'
                            }}>
                                <p style={{ marginBottom: '12px' }}>
                                    We built this app together over a weekend. My kids helped design the point system, cooldown timers, and the GOAT competition while I coded it.
                                </p>

                                <p style={{ marginBottom: '12px' }}>
                                    It's a work in progress. We're a small product teamâ€”just our familyâ€”building something for ourselves. We find bugs, report them to each other, and fix them together.
                                </p>

                                <p style={{ marginBottom: '12px' }}>
                                    Tech: React + Supabase in a single HTML file. No build tools, no complexity. Just what we needed to make chores less painful.
                                </p>

                                <p style={{
                                    fontSize: '0.875rem',
                                    fontStyle: 'italic',
                                    color: darkMode ? '#888' : '#999',
                                    marginTop: '16px',
                                    paddingTop: '16px',
                                    borderTop: `1px solid ${darkMode ? '#333' : '#E0E0E0'}`
                                }}>
                                    Status: In active development ðŸš§<br/>
                                    Team: Dad + 2 kids<br/>
                                    Goal: Make chores not suck
                                </p>
                            </div>
                        </div>

                        <div style={{
                            marginTop: '32px',
                            fontSize: '0.75rem',
                            color: darkMode ? '#9E9E9E' : '#5F6368'
                        }}>
                            Created by Matthew Gissentanna
                        </div>
                    </div>
                );
            }

            return (
                <div style={{
                    minHeight: '100vh',
                    background: theme.bg,
                    color: theme.text,
                    padding: '12px',
                    fontFamily: "'Google Sans', -apple-system, BlinkMacSystemFont, sans-serif",
                    width: '100%',
                    maxWidth: '100vw',
                    overflow: 'hidden'
                }}>
                    {/* Pull to Refresh Indicator */}
                    <div style={{
                        position: 'fixed',
                        top: 0,
                        left: 0,
                        right: 0,
                        height: `${Math.min(pullDistance, 80)}px`,
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        background: theme.primary,
                        opacity: pullDistance > 0 ? pullDistance / 80 : 0,
                        transition: refreshing ? 'opacity 0.3s' : 'none',
                        zIndex: 9999,
                        pointerEvents: 'none'
                    }}>
                        {refreshing ? (
                            <div style={{
                                width: '24px',
                                height: '24px',
                                border: '3px solid rgba(255,255,255,0.3)',
                                borderTop: '3px solid white',
                                borderRadius: '50%',
                                animation: 'spin 1s linear infinite'
                            }} />
                        ) : (
                            <div style={{
                                color: 'white',
                                fontSize: '0.875rem',
                                fontWeight: '600'
                            }}>
                                {pullDistance > 80 ? 'â†“ Release to refresh' : 'â†“ Pull to refresh'}
                            </div>
                        )}
                    </div>

                    {/* Material Top App Bar */}
                    <div className="elevation-2" style={{
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        padding: '8px 12px',
                        marginBottom: '16px',
                        background: theme.surface,
                        borderRadius: '12px',
                        minHeight: '56px'
                    }}>
                        <div style={{
                            display: 'flex',
                            alignItems: 'center',
                            gap: '8px',
                            minWidth: 0,
                            flex: '0 1 auto'
                        }}>
                            {/* Logo */}
                            <div style={{
                                width: '36px',
                                height: '36px',
                                borderRadius: '50%',
                                overflow: 'hidden',
                                flexShrink: 0
                            }}>
                                <svg width="36" height="36" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="256" cy="256" r="230" fill={darkMode ? '#FFFFFF' : '#000000'}/>
                                    <path d="M 180 140 Q 140 140, 140 180 L 140 332 Q 140 372, 180 372 L 260 372 L 260 312 L 200 312 L 200 200 L 260 200 L 260 266 L 300 266 L 300 170 Q 300 140, 270 140 Z"
                                          fill={darkMode ? '#000000' : '#FFFFFF'}/>
                                    <path d="M 360 140 Q 320 140, 320 180 L 320 332 Q 320 372, 360 372 L 372 372 L 372 312 L 360 312 Q 360 312, 360 302 L 360 210 Q 360 200, 372 200 L 372 140 Z"
                                          fill={darkMode ? '#000000' : '#FFFFFF'}/>
                                </svg>
                            </div>
                            <h1 style={{
                                fontSize: '1.125rem',
                                fontWeight: '500',
                                margin: 0,
                                color: theme.text,
                                fontFamily: "'Google Sans Display', sans-serif",
                                letterSpacing: '0',
                                overflow: 'hidden',
                                textOverflow: 'ellipsis',
                                whiteSpace: 'nowrap'
                            }}>
                                GyattChores
                            </h1>
                        </div>
                    </div>

                    {/* Navigation Buttons */}
                    <div className="elevation-1" style={{
                        display: 'flex',
                        gap: '8px',
                        padding: '12px',
                        marginBottom: '16px',
                        background: theme.surface,
                        borderRadius: '12px',
                        flexWrap: 'wrap'
                    }}>
                        <button
                            className="material-button elevation-1 ripple"
                            onClick={async () => {
                                await loadMonthlyChores();
                                setShowMonthlyView(true);
                            }}
                            style={{
                                flex: '1 1 auto',
                                minWidth: '120px',
                                background: theme.accent,
                                color: '#FFFFFF'
                            }}
                            aria-label="View monthly chores"
                        >
                            Monthly View
                        </button>
                        <a
                            href="ebook.html"
                            className="material-button elevation-1 ripple"
                            style={{
                                flex: '1 1 auto',
                                minWidth: '120px',
                                background: theme.accent,
                                color: '#FFFFFF',
                                textDecoration: 'none',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center'
                            }}
                            aria-label="Open Family Guide"
                        >
                            Family Guide
                        </a>
                        <a
                            href="development-story.html"
                            className="material-button elevation-1 ripple"
                            style={{
                                flex: '1 1 auto',
                                minWidth: '120px',
                                background: '#9C27B0',
                                color: '#FFFFFF',
                                textDecoration: 'none',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center'
                            }}
                            aria-label="Open Development Story"
                        >
                            Development Story
                        </a>
                        <button
                            className="material-button elevation-1 ripple"
                            onClick={handleLogout}
                            aria-label="Logout"
                            style={{
                                flex: '1 1 auto',
                                minWidth: '120px',
                                background: theme.error || '#f44336',
                                color: '#FFFFFF'
                            }}
                        >
                            Logout
                        </button>
                        <button
                            className="material-button elevation-1 ripple"
                            onClick={() => setDarkMode(!darkMode)}
                            aria-label={darkMode ? 'Switch to light mode' : 'Switch to dark mode'}
                            style={{
                                flex: '1 1 auto',
                                minWidth: '120px',
                                background: theme.primary,
                                color: theme.onPrimary
                            }}
                        >
                            {darkMode ? 'Light Mode' : 'Dark Mode'}
                        </button>
                    </div>

                    {/* Achievement Unlock Notifications */}
                    {newAchievements.length > 0 && (
                        <div style={{
                            position: 'fixed',
                            top: '20px',
                            right: '20px',
                            zIndex: 1000,
                            display: 'flex',
                            flexDirection: 'column',
                            gap: '12px',
                            maxWidth: '350px'
                        }}>
                            {newAchievements.map((achievement, idx) => {
                                const player = players.find(p => p.id === achievement.playerId);
                                return (
                                    <div key={`${achievement.id}-${achievement.playerId}-${idx}`}
                                        className="material-card elevation-3"
                                        style={{
                                            padding: '16px',
                                            background: darkMode ? '#1E1E1E' : '#FFFFFF',
                                            border: `2px solid ${theme.primary}`,
                                            boxShadow: '0 8px 24px rgba(0,0,0,0.3)',
                                            animation: 'slideInRight 0.3s ease-out'
                                        }}>
                                        <div style={{
                                            fontSize: '0.6875rem',
                                            fontWeight: '600',
                                            textTransform: 'uppercase',
                                            letterSpacing: '1px',
                                            color: theme.primary,
                                            marginBottom: '8px'
                                        }}>
                                            ðŸ† Achievement Unlocked!
                                        </div>
                                        <div style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '12px'
                                        }}>
                                            <div style={{ fontSize: '3rem' }}>
                                                {achievement.icon}
                                            </div>
                                            <div style={{ flex: 1 }}>
                                                <div style={{
                                                    fontSize: '1rem',
                                                    fontWeight: '600',
                                                    color: theme.text,
                                                    marginBottom: '4px'
                                                }}>
                                                    {achievement.name}
                                                </div>
                                                <div style={{
                                                    fontSize: '0.8125rem',
                                                    color: theme.textSecondary,
                                                    marginBottom: '4px'
                                                }}>
                                                    {achievement.description}
                                                </div>
                                                {player && (
                                                    <div style={{
                                                        fontSize: '0.75rem',
                                                        color: theme.primary,
                                                        fontWeight: '500'
                                                    }}>
                                                        {player.avatar} {player.name}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}

                    {/* Dashboard Header - Key Info */}
                    <div style={{
                        display: 'grid',
                        gridTemplateColumns: 'repeat(auto-fit, minmax(350px, 1fr))',
                        gap: '20px',
                        padding: '0 20px',
                        margin: '0 0 24px 0'
                    }}>
                        {/* Daily Quote */}
                        {(() => {
                            const dailyQuote = getDailyQuote();
                            return (
                                <div className="material-card elevation-1" style={{
                                    padding: '24px',
                                    background: theme.cardBg,
                                    borderLeft: `4px solid ${theme.primary}`
                                }}>
                                    <div style={{
                                        fontSize: '0.875rem',
                                        fontWeight: '600',
                                        textTransform: 'uppercase',
                                        letterSpacing: '1.5px',
                                        color: theme.textSecondary,
                                        marginBottom: '12px'
                                    }}>
                                        ðŸ’­ Today's Inspiration
                                    </div>
                                    <div style={{
                                        fontSize: '1.25rem',
                                        fontStyle: 'italic',
                                        color: theme.cardText,
                                        marginBottom: '8px',
                                        lineHeight: '1.6'
                                    }}>
                                        "{dailyQuote.quote}"
                                    </div>
                                    <div style={{
                                        fontSize: '1.125rem',
                                        fontWeight: '500',
                                        color: theme.textSecondary
                                    }}>
                                        â€” {dailyQuote.author}
                                    </div>
                                </div>
                            );
                        })()}

                        {/* Weather */}
                        {weather && !weatherLoading && (
                            <div className="material-card elevation-1" style={{
                                padding: '24px',
                                background: theme.cardBg
                            }}>
                                <div style={{
                                    fontSize: '0.875rem',
                                    fontWeight: '600',
                                    textTransform: 'uppercase',
                                    letterSpacing: '1.5px',
                                    color: theme.textSecondary,
                                    marginBottom: '12px'
                                }}>
                                    ðŸŒ¤ï¸ Brighton, CO Weather
                                </div>
                                <div style={{
                                    fontSize: '2.75rem',
                                    fontWeight: '700',
                                    color: theme.primary,
                                    marginBottom: '8px'
                                }}>
                                    {Math.round(weather.temp)}Â°F
                                </div>
                                <div style={{
                                    fontSize: '1.125rem',
                                    color: theme.cardText,
                                    marginBottom: '8px'
                                }}>
                                    {weather.description}
                                </div>
                                <div style={{
                                    fontSize: '1rem',
                                    color: theme.textSecondary
                                }}>
                                    ðŸ‘• {weather.clothing}
                                </div>

                                {/* Tomorrow's Forecast */}
                                {weather.tomorrow && (
                                    <div style={{
                                        marginTop: '20px',
                                        paddingTop: '20px',
                                        borderTop: `1px solid ${theme.outline}`
                                    }}>
                                        <div style={{
                                            fontSize: '0.75rem',
                                            fontWeight: '600',
                                            textTransform: 'uppercase',
                                            letterSpacing: '1px',
                                            color: theme.textSecondary,
                                            marginBottom: '8px'
                                        }}>
                                            ðŸ“… Tomorrow
                                        </div>
                                        <div style={{
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '12px'
                                        }}>
                                            <div style={{
                                                fontSize: '2rem'
                                            }}>
                                                {weather.tomorrow.icon}
                                            </div>
                                            <div style={{ flex: 1 }}>
                                                <div style={{
                                                    fontSize: '1.125rem',
                                                    fontWeight: '600',
                                                    color: theme.cardText
                                                }}>
                                                    {weather.tomorrow.maxTemp}Â° / {weather.tomorrow.minTemp}Â°F
                                                </div>
                                                <div style={{
                                                    fontSize: '0.875rem',
                                                    color: theme.textSecondary
                                                }}>
                                                    {weather.tomorrow.description}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Next Payout */}
                        <div className="material-card elevation-1" style={{
                            padding: '16px',
                            background: theme.cardBg,
                            textAlign: 'center'
                        }}>
                            <div style={{
                                fontSize: '0.6875rem',
                                fontWeight: '500',
                                textTransform: 'uppercase',
                                letterSpacing: '1px',
                                color: theme.textSecondary,
                                marginBottom: '8px'
                            }}>
                                ðŸ’¸ Next Payout
                            </div>
                            <div style={{
                                fontSize: '1.125rem',
                                fontWeight: '500',
                                color: theme.cardText
                            }}>
                                {payoutDate}
                            </div>
                        </div>

                        {/* Weekly GOAT */}
                        {weeklyGoats.length > 0 && (
                            <div className="material-card elevation-1" style={{
                                padding: '16px',
                                background: theme.cardBg,
                                border: '2px solid #FFD700',
                                boxShadow: '0 0 16px rgba(255, 215, 0, 0.2), 0 2px 8px 0 rgba(0,0,0,.1)'
                            }}>
                                <div style={{
                                    fontSize: '0.6875rem',
                                    fontWeight: '500',
                                    textTransform: 'uppercase',
                                    letterSpacing: '1px',
                                    color: theme.textSecondary,
                                    marginBottom: '8px'
                                }}>
                                    ðŸ {weeklyGoats.length > 1 ? 'CO-GOATS' : 'GOAT'} OF THE WEEK
                                </div>
                                <div style={{
                                    fontSize: '1.125rem',
                                    fontWeight: '600',
                                    color: '#FFD700',
                                    marginBottom: '4px'
                                }}>
                                    {weeklyGoats.map(g => g.player_name).join(' & ')}
                                </div>
                                <div style={{
                                    fontSize: '0.875rem',
                                    color: theme.textSecondary
                                }}>
                                    {weeklyGoats[0].weekly_total.toLocaleString()} points
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Dashboard Grid */}
                    <div className="dashboard-grid">
                        {/* Players Column */}
                        <div>
                            <div style={{
                                fontSize: '0.75rem',
                                fontWeight: '600',
                                marginBottom: '8px',
                                textTransform: 'uppercase',
                                letterSpacing: '1px',
                                color: theme.textSecondary,
                                paddingLeft: '4px'
                            }}>
                                Players
                            </div>
                            {players.map(player => (
                                <div key={player.id} className="material-card elevation-1" style={{
                                    padding: '12px',
                                    marginBottom: '8px',
                                    background: theme.cardBg,
                                    border: isGoat(player.id) ? '2px solid #FFD700' : 'none',
                                    boxShadow: isGoat(player.id)
                                        ? '0 0 12px rgba(255, 215, 0, 0.2), 0 2px 8px 0 rgba(0,0,0,.1)'
                                        : undefined
                                }}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '8px' }}>
                                        <div
                                            onClick={async () => {
                                                const newEmoji = prompt(`Pick a new emoji for ${player.name}:`, player.avatar);
                                                if (newEmoji && newEmoji.trim() && newEmoji !== player.avatar) {
                                                    try {
                                                        const { error } = await supabase
                                                            .from('players')
                                                            .update({ avatar_url: newEmoji.trim() })
                                                            .eq('id', player.id);

                                                        if (error) throw error;

                                                        // Update local state
                                                        setPlayers(prev => prev.map(p =>
                                                            p.id === player.id ? { ...p, avatar: newEmoji.trim() } : p
                                                        ));

                                                        haptic('success');
                                                        alert(`âœ… Avatar updated for ${player.name}!`);
                                                    } catch (error) {
                                                        console.error('Error updating avatar:', error);
                                                        haptic('error');
                                                        alert('Failed to update avatar');
                                                    }
                                                }
                                            }}
                                            style={{
                                            fontSize: '2rem',
                                            width: '48px',
                                            height: '48px',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            borderRadius: '50%',
                                            background: darkMode ? 'rgba(71, 178, 196, 0.1)' : 'rgba(208, 165, 0, 0.1)',
                                            cursor: 'pointer',
                                            transition: 'transform 0.2s, background 0.2s',
                                            flexShrink: 0
                                        }}
                                        onMouseEnter={(e) => {
                                            e.currentTarget.style.transform = 'scale(1.05)';
                                            e.currentTarget.style.background = darkMode ? 'rgba(71, 178, 196, 0.2)' : 'rgba(208, 165, 0, 0.2)';
                                        }}
                                        onMouseLeave={(e) => {
                                            e.currentTarget.style.transform = 'scale(1)';
                                            e.currentTarget.style.background = darkMode ? 'rgba(71, 178, 196, 0.1)' : 'rgba(208, 165, 0, 0.1)';
                                        }}
                                        title="Click to change avatar"
                                        >
                                            {player.avatar}
                                        </div>
                                        <div style={{ flex: 1, minWidth: 0 }}>
                                            <div style={{
                                                fontSize: '1rem',
                                                fontWeight: '600',
                                                marginBottom: '2px',
                                                color: theme.cardText,
                                                fontFamily: "'Google Sans Display', sans-serif",
                                                overflow: 'hidden',
                                                textOverflow: 'ellipsis',
                                                whiteSpace: 'nowrap'
                                            }}>
                                                {player.name}
                                            </div>
                                            <div style={{
                                                fontSize: '0.8125rem',
                                                color: theme.textSecondary
                                            }}>
                                                {player.completedChores} chores
                                            </div>
                                            {(() => {
                                                const pendingCount = pendingChores.filter(c => c.playerId === player.id).length;
                                                if (pendingCount > 0) {
                                                    return (
                                                        <div style={{
                                                            fontSize: '0.75rem',
                                                            color: theme.accent,
                                                            fontWeight: '500'
                                                        }}>
                                                            â³ {pendingCount} pending
                                                        </div>
                                                    );
                                                }
                                            })()}
                                            {isGoat(player.id) && (
                                                <div className="chip" style={{
                                                    background: darkMode ? 'rgba(255, 215, 0, 0.25)' : 'rgba(255, 215, 0, 0.35)',
                                                    color: darkMode ? '#FDB022' : '#8B6914',
                                                    marginTop: '4px',
                                                    fontSize: '0.625rem',
                                                    fontWeight: '600',
                                                    display: 'inline-flex',
                                                    alignItems: 'center',
                                                    gap: '3px',
                                                    padding: '2px 6px'
                                                }}>
                                                    ðŸ {weeklyGoats.length > 1 ? 'CO-GOAT' : 'GOAT'}
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    <div className="chip" style={{
                                        background: darkMode ? 'rgba(71, 178, 196, 0.15)' : 'rgba(208, 165, 0, 0.15)',
                                        color: theme.primary,
                                        marginBottom: '6px',
                                        fontWeight: '500',
                                        fontSize: '0.75rem'
                                    }}>
                                        {player.points.toLocaleString()} pts
                                    </div>

                                    {player.completedChores >= 5 && (
                                        <div className="chip" style={{
                                            background: darkMode ? 'rgba(129, 201, 149, 0.15)' : 'rgba(15, 157, 88, 0.15)',
                                            color: theme.success,
                                            fontWeight: '500',
                                            fontSize: '0.6875rem'
                                        }}>
                                            ðŸ’° ${(Math.max(0, player.points || 0) / 250).toFixed(2)}
                                        </div>
                                    )}

                                    {(player.best_week_total || 0) > 0 && (
                                        <div style={{
                                            fontSize: '0.6875rem',
                                            color: theme.textSecondary,
                                            marginTop: '4px'
                                        }}>
                                            ðŸš€ Best: {(player.best_week_total || 0).toLocaleString()} pts
                                        </div>
                                    )}

                                    {/* Bonuses */}
                                    {playerBonuses[player.id] && playerBonuses[player.id].length > 0 && (
                                        <div style={{ marginTop: '6px', display: 'flex', flexWrap: 'wrap', gap: '4px' }}>
                                            {playerBonuses[player.id].map((bonus) => (
                                                <div key={bonus.id || `${bonus.bonus_type}-${bonus.awarded_at}`} className="chip" style={{
                                                    background: bonus.bonus_type === 'beat_goat'
                                                        ? (darkMode ? 'rgba(255, 87, 34, 0.2)' : 'rgba(255, 87, 34, 0.15)')
                                                        : (darkMode ? 'rgba(76, 175, 80, 0.2)' : 'rgba(76, 175, 80, 0.15)'),
                                                    color: bonus.bonus_type === 'beat_goat' ? '#FF5722' : '#4CAF50',
                                                    fontWeight: '600',
                                                    fontSize: '0.6875rem',
                                                    padding: '2px 6px'
                                                }}>
                                                    {bonus.bonus_type === 'beat_goat' ? 'ðŸ”¥' : 'ðŸš€'} +{bonus.bonus_amount}
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    {/* Latest Achievement */}
                                    {(() => {
                                        const playerAchs = playerAchievements[player.id] || [];
                                        if (playerAchs.length > 0) {
                                            // Get the most recent achievement
                                            const latest = playerAchs.sort((a, b) =>
                                                new Date(b.earned_at) - new Date(a.earned_at)
                                            )[0];
                                            const achievement = achievements.find(a => a.id === latest.achievement_id);

                                            if (achievement) {
                                                return (
                                                    <div style={{
                                                        marginTop: '6px',
                                                        padding: '6px',
                                                        background: theme.surface,
                                                        borderRadius: '6px',
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        gap: '6px',
                                                        fontSize: '0.6875rem'
                                                    }}>
                                                        <span style={{ fontSize: '1rem' }}>{achievement.icon}</span>
                                                        <div style={{ flex: 1, minWidth: 0 }}>
                                                            <div style={{
                                                                fontWeight: '600',
                                                                color: theme.cardText,
                                                                overflow: 'hidden',
                                                                textOverflow: 'ellipsis',
                                                                whiteSpace: 'nowrap'
                                                            }}>
                                                                {achievement.name}
                                                            </div>
                                                            <div style={{ color: theme.textSecondary, fontSize: '0.625rem' }}>
                                                                {playerAchs.length} {playerAchs.length === 1 ? 'achievement' : 'achievements'}
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            }
                                        }
                                        return null;
                                    })()}

                                    <button
                                        className="material-button ripple"
                                        onClick={async () => {
                                            setSelectedPlayer(player);
                                            await loadPlayerProfile(player.id);
                                            setShowProfile(true);
                                        }}
                                        style={{
                                            width: '100%',
                                            marginTop: '6px',
                                            padding: '8px 12px',
                                            background: theme.primary,
                                            color: theme.onPrimary,
                                            fontSize: '0.75rem'
                                        }}
                                    >
                                        View Profile
                                    </button>
                                </div>
                            ))}

                            {/* Last Week's GOAT */}
                            {lastWeekGoat && lastWeekGoat.length > 0 && (
                                <div className="material-card elevation-1" style={{
                                    padding: '12px',
                                    background: theme.cardBg,
                                    textAlign: 'center',
                                    marginBottom: '8px'
                                }}>
                                    <div style={{
                                        fontSize: '0.6875rem',
                                        fontWeight: '500',
                                        textTransform: 'uppercase',
                                        letterSpacing: '1px',
                                        color: theme.textSecondary,
                                        marginBottom: '8px'
                                    }}>
                                        Last Week's GOAT
                                    </div>
                                    <div style={{
                                        fontSize: '1rem',
                                        fontWeight: '500',
                                        color: theme.cardText
                                    }}>
                                        ðŸ {lastWeekGoat.map(g => g.player_name).join(' & ')}
                                    </div>
                                    <div style={{
                                        fontSize: '0.875rem',
                                        color: theme.textSecondary,
                                        marginTop: '4px'
                                    }}>
                                        {lastWeekGoat[0].weekly_total.toLocaleString()} points
                                    </div>
                                </div>
                            )}

                            {/* Game Rules */}
                            <div style={{
                                fontSize: '0.6875rem',
                                fontWeight: '500',
                                marginBottom: '16px',
                                textTransform: 'uppercase',
                                letterSpacing: '1px',
                                color: theme.textSecondary,
                                paddingLeft: '8px'
                            }}>
                                Game Rules
                            </div>
                            <div className="material-card elevation-1" style={{
                                padding: '16px',
                                background: theme.cardBg,
                                fontSize: '0.875rem',
                                lineHeight: '1.6',
                                color: theme.cardText
                            }}>
                                <div style={{ marginBottom: '16px' }}>
                                    <div style={{ 
                                        fontWeight: '500', 
                                        marginBottom: '8px',
                                        color: theme.primary,
                                        fontSize: '1rem'
                                    }}>
                                        ðŸ’° Points System
                                    </div>
                                    <div className="text-wrap">
                                        Earn points by completing chores. After 5 completed chores, your dollar amount unlocks!
                                    </div>
                                </div>

                                <div style={{ marginBottom: '16px' }}>
                                    <div style={{ 
                                        fontWeight: '500', 
                                        marginBottom: '8px',
                                        color: theme.primary,
                                        fontSize: '1rem'
                                    }}>
                                        âœ… How to Play
                                    </div>
                                    <div className="text-wrap">
                                        1. Pick a chore<br/>
                                        2. Complete it<br/>
                                        3. Wait for approval<br/>
                                        4. Points added!
                                    </div>
                                </div>

                                <div style={{ marginBottom: '16px' }}>
                                    <div style={{ 
                                        fontWeight: '500', 
                                        marginBottom: '8px',
                                        color: theme.primary,
                                        fontSize: '1rem'
                                    }}>
                                        ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ Approval
                                    </div>
                                    <div className="text-wrap">
                                        An admin will review and approve your completed chores.
                                    </div>
                                </div>

                                <div>
                                    <div style={{ 
                                        fontWeight: '500', 
                                        marginBottom: '8px',
                                        color: theme.primary,
                                        fontSize: '1rem'
                                    }}>
                                        ðŸ’¸ Payout
                                    </div>
                                    <div className="text-wrap">
                                        Payments happen on the last Friday of each month. Keep earning!
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Available Chores Column */}
                        <div>
                            <div style={{
                                fontSize: '0.75rem',
                                fontWeight: '600',
                                marginBottom: '8px',
                                textTransform: 'uppercase',
                                letterSpacing: '1px',
                                color: theme.textSecondary,
                                paddingLeft: '4px'
                            }}>
                                Available Chores
                            </div>
                            <div>
                                {chores
                                .sort((a, b) => {
                                    // Custom tasks (â­) first
                                    const aIsCustom = a.icon === 'â­';
                                    const bIsCustom = b.icon === 'â­';
                                    if (aIsCustom && !bIsCustom) return -1;
                                    if (!aIsCustom && bIsCustom) return 1;
                                    return 0;
                                })
                                .filter(chore => {
                                    // Check if chore is available based on cooldown
                                    const availability = getChoreAvailability(chore);
                                    return availability.available;
                                }).map((chore, idx) => {
                                    const isCustomTask = chore.icon === 'â­';
                                    return (
                                    <div key={chore.id || idx} className="material-card elevation-1" style={{
                                        marginBottom: '6px',
                                        overflow: 'hidden',
                                        background: theme.cardBg,
                                        border: isCustomTask ? `2px solid ${theme.accent}` : 'none',
                                        boxShadow: isCustomTask
                                            ? `0 0 12px ${darkMode ? 'rgba(18, 10, 204, 0.3)' : 'rgba(235, 112, 30, 0.3)'}, 0 2px 8px 0 rgba(0,0,0,.1)`
                                            : undefined
                                    }}>
                                        <div style={{ padding: '8px' }}>
                                            <div style={{
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '6px',
                                                marginBottom: '6px'
                                            }}>
                                                <div style={{
                                                    fontSize: '1.25rem',
                                                    width: '32px',
                                                    height: '32px',
                                                    flexShrink: 0,
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    borderRadius: '6px',
                                                    background: darkMode ? 'rgba(71, 178, 196, 0.1)' : 'rgba(208, 165, 0, 0.1)'
                                                }}>
                                                    {chore.icon}
                                                </div>
                                                <div style={{ flex: 1, minWidth: 0 }}>
                                                    <div style={{
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        gap: '4px',
                                                        marginBottom: '1px'
                                                    }}>
                                                        <div style={{
                                                            fontSize: '0.875rem',
                                                            fontWeight: '600',
                                                            color: theme.cardText,
                                                            overflow: 'hidden',
                                                            textOverflow: 'ellipsis',
                                                            whiteSpace: 'nowrap',
                                                            flex: 1
                                                        }}>
                                                            {chore.name}
                                                        </div>
                                                    </div>
                                                    <div style={{
                                                        fontSize: '0.75rem',
                                                        fontWeight: '600',
                                                        color: theme.primary
                                                    }}>
                                                        {chore.points} pts
                                                    </div>
                                                    {!isCustomTask && chore.description && (
                                                        <div style={{
                                                            fontSize: '0.6875rem',
                                                            color: theme.textSecondary,
                                                            marginTop: '8px',
                                                            padding: '8px',
                                                            background: darkMode ? 'rgba(71, 178, 196, 0.05)' : 'rgba(208, 165, 0, 0.05)',
                                                            borderRadius: '6px',
                                                            lineHeight: '1.4',
                                                            borderLeft: `3px solid ${theme.primary}`
                                                        }}>
                                                            <strong style={{ color: theme.primary }}>Definition of Done:</strong><br />
                                                            {chore.description}
                                                        </div>
                                                    )}
                                                    {isCustomTask && chore.description && (() => {
                                                        try {
                                                            const desc = JSON.parse(chore.description);
                                                            if (desc.due_date) {
                                                                const dueDate = new Date(desc.due_date);
                                                                const today = new Date();
                                                                today.setHours(0, 0, 0, 0);
                                                                dueDate.setHours(0, 0, 0, 0);
                                                                const daysUntil = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));

                                                                let dueDateText = '';
                                                                let dueDateColor = theme.textSecondary;

                                                                if (daysUntil < 0) {
                                                                    dueDateText = 'OVERDUE';
                                                                    dueDateColor = theme.error;
                                                                } else if (daysUntil === 0) {
                                                                    dueDateText = 'Due Today!';
                                                                    dueDateColor = theme.error;
                                                                } else if (daysUntil === 1) {
                                                                    dueDateText = 'Due Tomorrow';
                                                                    dueDateColor = theme.accent;
                                                                } else {
                                                                    dueDateText = `Due in ${daysUntil} days`;
                                                                }

                                                                return (
                                                                    <div style={{
                                                                        fontSize: '0.6875rem',
                                                                        fontWeight: '500',
                                                                        color: dueDateColor,
                                                                        marginTop: '2px',
                                                                        overflow: 'hidden',
                                                                        textOverflow: 'ellipsis',
                                                                        whiteSpace: 'nowrap',
                                                                        maxWidth: '100%',
                                                                        width: 'fit-content'
                                                                    }}>
                                                                        ðŸ“… {dueDateText}
                                                                    </div>
                                                                );
                                                            }
                                                        } catch (e) {}
                                                        return null;
                                                    })()}
                                                </div>
                                            </div>
                                            <div style={{
                                                display: 'flex',
                                                flexWrap: 'wrap',
                                                gap: '4px'
                                            }}>
                                                {players.map(player => (
                                                    <button
                                                        key={player.id}
                                                        onClick={() => claimChore(player.id, chore)}
                                                        className="ripple"
                                                        style={{
                                                            flex: '1 1 auto',
                                                            minWidth: '48px',
                                                            padding: '8px',
                                                            background: theme.primary,
                                                            color: theme.onPrimary,
                                                            border: 'none',
                                                            cursor: 'pointer',
                                                            fontSize: '1.25rem',
                                                            borderRadius: '8px',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center'
                                                        }}
                                                        title={player.name}
                                                        aria-label={`${player.name} claim chore`}
                                                    >
                                                        {player.avatar}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                        {isCustomTask && (
                                            <button
                                                onClick={async () => {
                                                    const code = prompt('Enter admin code to delete this custom task:');
                                                    if (code !== APPROVAL_CODE) {
                                                        if (code !== null) {
                                                            haptic('error');
                                                            alert('âŒ Invalid admin code');
                                                        }
                                                        return;
                                                    }

                                                    if (!confirm(`Delete custom task "${chore.name}"?`)) {
                                                        return;
                                                    }

                                                    try {
                                                        const { error } = await supabase
                                                            .from('chores')
                                                            .update({ is_active: false })
                                                            .eq('id', chore.id);

                                                        if (error) throw error;

                                                        setChores(prev => prev.filter(c => c.id !== chore.id));
                                                        haptic('success');
                                                        alert('âœ… Custom task deleted!');
                                                    } catch (error) {
                                                        console.error('Error deleting task:', error);
                                                        haptic('error');
                                                        alert(`Error deleting custom task: ${error.message || 'Unknown error'}`);
                                                    }
                                                }}
                                                className="ripple"
                                                style={{
                                                    width: '100%',
                                                    padding: '10px',
                                                    background: theme.error,
                                                    color: '#FFFFFF',
                                                    border: 'none',
                                                    cursor: 'pointer',
                                                    fontSize: '0.8125rem',
                                                    fontWeight: '500',
                                                    marginTop: '1px'
                                                }}
                                            >
                                                ðŸ—‘ï¸ Cancel Task
                                            </button>
                                        )}
                                    </div>
                                );
                                })}
                            </div>

                            {/* Coming Soon (Chores on Cooldown) */}
                            {(() => {
                                const unavailableChores = chores
                                    .map(chore => ({
                                        ...chore,
                                        availability: getChoreAvailability(chore)
                                    }))
                                    .filter(chore => !chore.availability.available)
                                    .sort((a, b) => a.availability.hoursRemaining - b.availability.hoursRemaining);

                                if (unavailableChores.length === 0) return null;

                                return (
                                    <>
                                        <div style={{
                                            fontSize: '0.6875rem',
                                            fontWeight: '500',
                                            textTransform: 'uppercase',
                                            letterSpacing: '1px',
                                            color: theme.textSecondary,
                                            paddingLeft: '8px',
                                            marginTop: '24px',
                                            marginBottom: '8px'
                                        }}>
                                            Coming Soon
                                        </div>
                                        {unavailableChores.map((chore, idx) => {
                                            const days = Math.floor(chore.availability.hoursRemaining / 24);
                                            const hours = chore.availability.hoursRemaining % 24;
                                            let timeText = '';
                                            if (days > 0) {
                                                timeText = `${days}d`;
                                                if (hours > 0) timeText += ` ${hours}h`;
                                            } else {
                                                timeText = `${hours}h`;
                                            }

                                            return (
                                                <div key={chore.id || idx} className="material-card" style={{
                                                    marginBottom: '8px',
                                                    padding: '12px',
                                                    background: theme.cardBg,
                                                    opacity: 0.6,
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    gap: '12px'
                                                }}>
                                                    <div style={{ fontSize: '1.25rem' }}>{chore.icon}</div>
                                                    <div style={{ flex: 1, minWidth: 0 }}>
                                                        <div style={{
                                                            fontSize: '0.875rem',
                                                            fontWeight: '500',
                                                            color: theme.cardText,
                                                            overflow: 'hidden',
                                                            textOverflow: 'ellipsis',
                                                            whiteSpace: 'nowrap'
                                                        }}>
                                                            {chore.name}
                                                        </div>
                                                        <div style={{
                                                            fontSize: '0.75rem',
                                                            color: theme.textSecondary
                                                        }}>
                                                            {chore.points} pts
                                                        </div>
                                                    </div>
                                                    <div style={{
                                                        fontSize: '0.75rem',
                                                        fontWeight: '500',
                                                        color: theme.accent,
                                                        whiteSpace: 'nowrap'
                                                    }}>
                                                        â³ {timeText}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </>
                                );
                            })()}
                        </div>

                        {/* Pending Approval Column */}
                        <div>
                            <div style={{
                                fontSize: '0.75rem',
                                fontWeight: '600',
                                marginBottom: '8px',
                                textTransform: 'uppercase',
                                letterSpacing: '1px',
                                color: theme.textSecondary,
                                paddingLeft: '4px'
                            }}>
                                Pending Approval
                            </div>

                            {pendingChores.length > 0 && (
                                <div className="material-card elevation-2" style={{
                                    marginBottom: '8px',
                                    padding: '12px',
                                    background: theme.cardBg
                                }}>
                                    <div style={{
                                        fontSize: '0.6875rem',
                                        fontWeight: '500',
                                        marginBottom: '12px',
                                        color: theme.textSecondary,
                                        textTransform: 'uppercase',
                                        letterSpacing: '1px'
                                    }}>
                                        Admin Controls
                                    </div>
                                    <button
                                        className="material-button elevation-1 ripple"
                                        onClick={async () => {
                                            const code = prompt('Enter admin code to approve all:');
                                            if (code !== APPROVAL_CODE) {
                                                if (code !== null) {
                                                    haptic('error');
                                                    alert('âŒ Invalid admin code');
                                                }
                                                return;
                                            }

                                            try {
                                                // Get all pending chores before approving
                                                const { data: pendingToApprove, error: fetchError } = await supabase
                                                    .from('chore_completions')
                                                    .select('player_id, completed_at, value_awarded')
                                                    .eq('status', 'pending');

                                                if (fetchError) throw fetchError;

                                                // Approve all pending chores in database
                                                const { error } = await supabase
                                                    .from('chore_completions')
                                                    .update({ status: 'approved' })
                                                    .eq('status', 'pending');

                                                if (error) throw error;

                                                // Update stats for each approval
                                                if (pendingToApprove && pendingToApprove.length > 0) {
                                                    for (const chore of pendingToApprove) {
                                                        await updatePlayerStats(chore.player_id, chore.completed_at, chore.value_awarded);
                                                    }

                                                    // Check achievements for all affected players
                                                    const uniquePlayers = [...new Set(pendingToApprove.map(c => c.player_id))];
                                                    for (const playerId of uniquePlayers) {
                                                        await checkAndAwardAchievements(playerId);
                                                    }
                                                }

                                                setPendingChores([]);
                                                await loadAllCompletions();
                                                await loadData();
                                                haptic('success');
                                                alert('âœ… All chores approved!');
                                            } catch (error) {
                                                console.error('Error approving all:', error);
                                                haptic('error');
                                                alert(`Error approving chores: ${error.message || 'Unknown error'}`);
                                            }
                                        }}
                                        style={{
                                            width: '100%',
                                            marginBottom: '8px',
                                            background: theme.success,
                                            color: '#FFFFFF'
                                        }}
                                    >
                                        Approve All ({pendingChores.length})
                                    </button>
                                    <button
                                        className="material-button elevation-1 ripple"
                                        onClick={async () => {
                                            const code = prompt('Enter admin code to reset:');
                                            if (code !== APPROVAL_CODE) {
                                                if (code !== null) {
                                                    haptic('error');
                                                    alert('âŒ Invalid admin code');
                                                }
                                                return;
                                            }

                                            if (!confirm('Clear all pending chores?')) {
                                                return;
                                            }

                                            try {
                                                // Delete all pending chores from database
                                                const { error } = await supabase
                                                    .from('chore_completions')
                                                    .delete()
                                                    .eq('status', 'pending');

                                                if (error) throw error;

                                                setPendingChores([]);
                                                await loadAllCompletions();
                                                await loadData();
                                                haptic('medium');
                                                alert('âœ… Pending chores cleared');
                                            } catch (error) {
                                                console.error('Error clearing pending:', error);
                                                haptic('error');
                                                alert(`Error clearing pending chores: ${error.message || 'Unknown error'}`);
                                            }
                                        }}
                                        style={{
                                            width: '100%',
                                            background: theme.error,
                                            color: '#FFFFFF'
                                        }}
                                    >
                                        Reset Pending
                                    </button>
                                    <button
                                        className="material-button elevation-1 ripple"
                                        onClick={async () => {
                                            const code = prompt('Enter admin code to force weekly reset:');
                                            if (code !== APPROVAL_CODE) {
                                                if (code !== null) {
                                                    haptic('error');
                                                    alert('âŒ Invalid admin code');
                                                }
                                                return;
                                            }

                                            if (!confirm('Force reset weekly points? This starts a new week.')) {
                                                return;
                                            }

                                            const monday = new Date();
                                            const dayOfWeek = monday.getDay();
                                            const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
                                            monday.setDate(monday.getDate() + daysToMonday);
                                            monday.setHours(0, 0, 0, 0);

                                            setCurrentWeekStart(monday.toISOString().split('T')[0]);
                                            setNeedsWeeklyReset(true);
                                            await performWeeklyReset();
                                        }}
                                        style={{
                                            width: '100%',
                                            marginTop: '8px',
                                            background: theme.accent,
                                            color: '#FFFFFF'
                                        }}
                                    >
                                        Force Weekly Reset
                                    </button>
                                    <button
                                        className="material-button elevation-1 ripple"
                                        onClick={async () => {
                                            const code = prompt('Enter admin code:');
                                            if (code === APPROVAL_CODE) {
                                                await loadAllCompletions();
                                                await loadErrorLogs();
                                                setShowAdminMenu(true);
                                            } else if (code !== null) {
                                                haptic('error');
                                                alert('âŒ Invalid admin code');
                                                // Log failed admin access attempt
                                                await logError('admin_failed', 'Incorrect admin code entered', code);
                                            }
                                        }}
                                        style={{
                                            width: '100%',
                                            marginTop: '8px',
                                            background: '#FF9800',
                                            color: '#FFFFFF'
                                        }}
                                    >
                                        Edit Approved Task
                                    </button>
                                </div>
                            )}

                            <div style={{
                                maxHeight: 'calc(100vh - 300px)',
                                overflowY: 'auto',
                                paddingRight: '4px'
                            }}>
                                {pendingChores.length === 0 ? (
                                    <div className="material-card" style={{
                                        padding: '32px 24px',
                                        textAlign: 'center',
                                        color: theme.textSecondary,
                                        fontSize: '0.875rem',
                                        background: theme.cardBg,
                                        border: `2px dashed ${theme.outline}`
                                    }}>
                                        No pending chores
                                    </div>
                                ) : (
                                    pendingChores.map(chore => {
                                        const player = players.find(p => p.id === chore.playerId);
                                        return (
                                            <div key={chore.id} className="material-card elevation-1" style={{
                                                marginBottom: '12px',
                                                padding: '16px',
                                                background: darkMode ? 'rgba(251, 191, 36, 0.15)' : '#FEF3C7',
                                                border: `2px solid ${darkMode ? '#fbbf24' : '#f59e0b'}`
                                            }}>
                                                <div style={{
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    gap: '12px',
                                                    marginBottom: '12px'
                                                }}>
                                                    <div style={{ fontSize: '1.5rem' }}>{chore.icon}</div>
                                                    <div style={{ flex: 1 }}>
                                                        <div className="text-wrap" style={{
                                                            fontSize: '1rem',
                                                            fontWeight: '500',
                                                            marginBottom: '4px',
                                                            color: darkMode ? '#fbbf24' : '#78350f'
                                                        }}>
                                                            {chore.choreName}
                                                        </div>
                                                        <div style={{
                                                            fontSize: '0.875rem',
                                                            color: darkMode ? '#fbbf24' : '#92400e'
                                                        }}>
                                                            {player?.name} â€¢ {chore.points} pts
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                {showApproval === chore.id ? (
                                                    <div>
                                                        <input
                                                            type="password"
                                                            placeholder="Admin code"
                                                            value={approvalCode}
                                                            onChange={(e) => setApprovalCode(e.target.value)}
                                                            className="material-input"
                                                            style={{
                                                                marginBottom: '12px',
                                                                background: theme.cardBg,
                                                                borderColor: theme.outline,
                                                                color: theme.cardText
                                                            }}
                                                            onKeyPress={(e) => {
                                                                if (e.key === 'Enter') {
                                                                    approveChore(chore.id, approvalCode);
                                                                }
                                                            }}
                                                        />
                                                        <div style={{ display: 'flex', gap: '8px' }}>
                                                            <button
                                                                className="material-button ripple"
                                                                onClick={() => approveChore(chore.id, approvalCode)}
                                                                style={{
                                                                    flex: 1,
                                                                    background: theme.success,
                                                                    color: '#FFFFFF'
                                                                }}
                                                            >
                                                                Approve
                                                            </button>
                                                            <button
                                                                className="material-button ripple"
                                                                onClick={() => {
                                                                    if (approvalCode === APPROVAL_CODE) {
                                                                        rejectChore(chore.id);
                                                                    } else {
                                                                        haptic('error');
                                                                        alert('âŒ Invalid admin code');
                                                                    }
                                                                }}
                                                                style={{
                                                                    flex: 1,
                                                                    background: theme.error,
                                                                    color: '#FFFFFF'
                                                                }}
                                                            >
                                                                Reject
                                                            </button>
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <button
                                                        className="material-button ripple"
                                                        onClick={() => setShowApproval(chore.id)}
                                                        style={{
                                                            width: '100%',
                                                            background: theme.primary,
                                                            color: theme.onPrimary
                                                        }}
                                                    >
                                                        Review
                                                    </button>
                                                )}
                                            </div>
                                        );
                                    })
                                )}
                            </div>
                        </div>

                        {/* Create Task Column */}
                        <div>
                            <div style={{
                                fontSize: '0.6875rem',
                                fontWeight: '500',
                                marginBottom: '16px',
                                textTransform: 'uppercase',
                                letterSpacing: '1px',
                                color: theme.textSecondary,
                                paddingLeft: '8px'
                            }}>
                                Create Custom Task
                            </div>
                            <div className="material-card elevation-1" style={{
                                padding: '16px',
                                background: theme.cardBg,
                                marginBottom: '16px',
                                overflowX: 'hidden'
                            }}>
                                <input
                                    type="text"
                                    placeholder="Task name"
                                    value={newTaskName}
                                    onChange={(e) => setNewTaskName(e.target.value)}
                                    maxLength={100}
                                    required
                                    aria-label="Task name"
                                    className="material-input"
                                    style={{
                                        marginBottom: '12px',
                                        background: theme.surface,
                                        borderColor: theme.outline,
                                        color: theme.text
                                    }}
                                />
                                <input
                                    type="number"
                                    placeholder="Points"
                                    value={newTaskPoints}
                                    onChange={(e) => {
                                        const value = parseInt(e.target.value) || 0;
                                        setNewTaskPoints(Math.max(1, Math.min(10000, value)));
                                    }}
                                    min="1"
                                    max="10000"
                                    step="25"
                                    required
                                    aria-label="Points value"
                                    className="material-input"
                                    style={{
                                        marginBottom: '12px',
                                        background: theme.surface,
                                        borderColor: theme.outline,
                                        color: theme.text
                                    }}
                                />
                                <div style={{ width: '100%', overflow: 'hidden', marginBottom: '12px' }}>
                                    <input
                                        type="date"
                                        placeholder="Due date (optional)"
                                        value={newTaskDueDate}
                                        onChange={(e) => setNewTaskDueDate(e.target.value)}
                                        min={new Date().toISOString().split('T')[0]}
                                        max={new Date(Date.now() + 365*24*60*60*1000).toISOString().split('T')[0]}
                                        aria-label="Due date (optional)"
                                        className="material-input"
                                        style={{
                                            marginBottom: '0',
                                            background: theme.surface,
                                            borderColor: theme.outline,
                                            color: theme.text,
                                            colorScheme: darkMode ? 'dark' : 'light'
                                        }}
                                    />
                                </div>
                                <button
                                    className="material-button ripple"
                                    onClick={createTask}
                                    disabled={!newTaskName.trim() || !newTaskPoints || newTaskPoints <= 0}
                                    style={{
                                        width: '100%',
                                        background: (!newTaskName.trim() || !newTaskPoints || newTaskPoints <= 0)
                                            ? theme.outline
                                            : theme.secondary,
                                        color: '#FFFFFF',
                                        opacity: (!newTaskName.trim() || !newTaskPoints || newTaskPoints <= 0)
                                            ? 0.5
                                            : 1,
                                        cursor: (!newTaskName.trim() || !newTaskPoints || newTaskPoints <= 0)
                                            ? 'not-allowed'
                                            : 'pointer'
                                    }}
                                >
                                    Add Task
                                </button>
                            </div>
                            <div style={{
                                padding: '16px',
                                background: theme.cardBg,
                                borderRadius: '12px',
                                fontSize: '0.875rem',
                                color: theme.textSecondary,
                                textAlign: 'center'
                            }}>
                                Custom tasks appear in Available Chores
                            </div>
                        </div>

                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(FamilyChores));
    </script>
</body>
</html>
